var Nt=Object.defineProperty;var Zn=(o,t,e)=>t in o?Nt(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var et=(o,t)=>()=>(o&&(t=o(o=0)),t);var es=(o,t)=>{for(var e in t)Nt(o,e,{get:t[e],enumerable:!0})};var f=(o,t,e)=>(Zn(o,typeof t!="symbol"?t+"":t,e),e);var x,T,C=et(()=>{"use strict";x=class extends Error{constructor(e,n,s){super(e);f(this,"code");f(this,"details");this.code=n,this.details=s,this.name="EdgeFlowError"}},T={RUNTIME_NOT_AVAILABLE:"RUNTIME_NOT_AVAILABLE",RUNTIME_INIT_FAILED:"RUNTIME_INIT_FAILED",RUNTIME_NOT_INITIALIZED:"RUNTIME_NOT_INITIALIZED",MODEL_NOT_FOUND:"MODEL_NOT_FOUND",MODEL_LOAD_FAILED:"MODEL_LOAD_FAILED",MODEL_INVALID_FORMAT:"MODEL_INVALID_FORMAT",MODEL_NOT_LOADED:"MODEL_NOT_LOADED",INFERENCE_FAILED:"INFERENCE_FAILED",INFERENCE_TIMEOUT:"INFERENCE_TIMEOUT",INFERENCE_CANCELLED:"INFERENCE_CANCELLED",OUT_OF_MEMORY:"OUT_OF_MEMORY",MEMORY_LEAK_DETECTED:"MEMORY_LEAK_DETECTED",TENSOR_SHAPE_MISMATCH:"TENSOR_SHAPE_MISMATCH",TENSOR_DTYPE_MISMATCH:"TENSOR_DTYPE_MISMATCH",TENSOR_DISPOSED:"TENSOR_DISPOSED",PIPELINE_NOT_SUPPORTED:"PIPELINE_NOT_SUPPORTED",PIPELINE_INPUT_INVALID:"PIPELINE_INPUT_INVALID",INVALID_ARGUMENT:"INVALID_ARGUMENT",NOT_IMPLEMENTED:"NOT_IMPLEMENTED",UNKNOWN_ERROR:"UNKNOWN_ERROR"}});function ns(){return`tensor_${++ts}_${Date.now().toString(36)}`}function Fe(o){switch(o){case"float32":return Float32Array;case"float16":return Float32Array;case"int32":return Int32Array;case"int64":return BigInt64Array;case"uint8":case"bool":return Uint8Array;case"int8":return Int8Array;default:throw new x(`Unsupported data type: ${o}`,T.INVALID_ARGUMENT,{dtype:o})}}function Z(o){return o.length===0?1:o.reduce((t,e)=>t*e,1)}function ss(o){for(let t=0;t<o.length;t++){let e=o[t];if(e===void 0||!Number.isInteger(e)||e<0)throw new x(`Invalid shape dimension at index ${t}: ${e}`,T.INVALID_ARGUMENT,{shape:o,index:t,dimension:e})}}function Rt(o,t,e="float32"){if(Array.isArray(o)&&o.length>0&&Array.isArray(o[0])){let s=o.length,a=o[0].length,r=[];for(let i of o){if(i.length!==a)throw new x("Nested arrays must have consistent dimensions",T.INVALID_ARGUMENT);r.push(...i)}return new g(r,t??[s,a],e)}let n=t??[o.length];return new g(o,n,e)}function tt(o,t="float32"){let e=Z(o),n=Fe(t),s=new n(e);return new g(s,o,t)}function $t(o,t="float32"){let e=Z(o),n=Fe(t),s=new n(e);return s.fill(1),new g(s,o,t)}function Ot(o,t,e="float32"){let n=Z(o),s=Fe(e),a=new s(n);return a.fill(t),new g(a,o,e)}function Bt(o,t="float32"){let e=Z(o),n=new Float32Array(e);for(let s=0;s<e;s++)n[s]=Math.random();return new g(n,o,t)}function Ut(o,t="float32"){let e=Z(o),n=new Float32Array(e);for(let s=0;s<e;s+=2){let a=Math.random(),r=Math.random(),i=Math.sqrt(-2*Math.log(a)),c=2*Math.PI*r;n[s]=i*Math.cos(c),s+1<e&&(n[s+1]=i*Math.sin(c))}return new g(n,o,t)}function qt(o,t,e=1,n="float32"){t===void 0&&(t=o,o=0);let s=Math.ceil((t-o)/e),a=new Float32Array(s);for(let r=0;r<s;r++)a[r]=o+r*e;return new g(a,[s],n)}function jt(o,t,e=50,n="float32"){let s=new Float32Array(e),a=(t-o)/(e-1);for(let r=0;r<e;r++)s[r]=o+r*a;return new g(s,[e],n)}function Ht(o,t="float32"){let e=new Float32Array(o*o);for(let n=0;n<o;n++)e[n*o+n]=1;return new g(e,[o,o],t)}function Wt(o,t){if(typeof t=="number"){let a=new Float32Array(o.size),r=o.toFloat32Array();for(let i=0;i<o.size;i++)a[i]=(r[i]??0)+t;return new g(a,o.shape,o.dtype)}if(o.size!==t.size)throw new x("Tensor sizes must match for element-wise operations",T.TENSOR_SHAPE_MISMATCH,{aShape:o.shape,bShape:t.shape});let e=new Float32Array(o.size),n=o.toFloat32Array(),s=t.toFloat32Array();for(let a=0;a<o.size;a++)e[a]=(n[a]??0)+(s[a]??0);return new g(e,o.shape,o.dtype)}function Vt(o,t){if(typeof t=="number"){let a=new Float32Array(o.size),r=o.toFloat32Array();for(let i=0;i<o.size;i++)a[i]=(r[i]??0)-t;return new g(a,o.shape,o.dtype)}if(o.size!==t.size)throw new x("Tensor sizes must match for element-wise operations",T.TENSOR_SHAPE_MISMATCH,{aShape:o.shape,bShape:t.shape});let e=new Float32Array(o.size),n=o.toFloat32Array(),s=t.toFloat32Array();for(let a=0;a<o.size;a++)e[a]=(n[a]??0)-(s[a]??0);return new g(e,o.shape,o.dtype)}function Gt(o,t){if(typeof t=="number"){let a=new Float32Array(o.size),r=o.toFloat32Array();for(let i=0;i<o.size;i++)a[i]=(r[i]??0)*t;return new g(a,o.shape,o.dtype)}if(o.size!==t.size)throw new x("Tensor sizes must match for element-wise operations",T.TENSOR_SHAPE_MISMATCH,{aShape:o.shape,bShape:t.shape});let e=new Float32Array(o.size),n=o.toFloat32Array(),s=t.toFloat32Array();for(let a=0;a<o.size;a++)e[a]=(n[a]??0)*(s[a]??0);return new g(e,o.shape,o.dtype)}function nt(o,t){if(typeof t=="number"){let a=new Float32Array(o.size),r=o.toFloat32Array();for(let i=0;i<o.size;i++)a[i]=(r[i]??0)/t;return new g(a,o.shape,o.dtype)}if(o.size!==t.size)throw new x("Tensor sizes must match for element-wise operations",T.TENSOR_SHAPE_MISMATCH,{aShape:o.shape,bShape:t.shape});let e=new Float32Array(o.size),n=o.toFloat32Array(),s=t.toFloat32Array();for(let a=0;a<o.size;a++)e[a]=(n[a]??0)/(s[a]??0);return new g(e,o.shape,o.dtype)}function Xt(o,t){if(o.shape.length!==2||t.shape.length!==2)throw new x("matmul requires 2D tensors",T.INVALID_ARGUMENT,{aShape:o.shape,bShape:t.shape});let[e,n]=o.shape,[s,a]=t.shape;if(n!==s)throw new x(`Matrix dimensions incompatible for multiplication: (${e}x${n}) @ (${s}x${a})`,T.TENSOR_SHAPE_MISMATCH,{aShape:o.shape,bShape:t.shape});let r=new Float32Array(e*a),i=o.toFloat32Array(),c=t.toFloat32Array();for(let l=0;l<e;l++)for(let u=0;u<a;u++){let d=0;for(let h=0;h<n;h++)d+=(i[l*n+h]??0)*(c[h*a+u]??0);r[l*a+u]=d}return new g(r,[e,a],o.dtype)}function D(o,t=-1){let e=o.toFloat32Array(),n=new Float32Array(o.size),s=t<0?o.shape.length+t:t;if(s<0||s>=o.shape.length)throw new x(`Invalid axis ${t} for tensor with ${o.shape.length} dimensions`,T.INVALID_ARGUMENT,{axis:t,shape:o.shape});if(o.shape.length===1){let a=-1/0;for(let i=0;i<o.size;i++)(e[i]??0)>a&&(a=e[i]??0);let r=0;for(let i=0;i<o.size;i++)n[i]=Math.exp((e[i]??0)-a),r+=n[i]??0;for(let i=0;i<o.size;i++)n[i]=(n[i]??0)/r;return new g(n,o.shape,o.dtype)}if(o.shape.length===2&&s===1){let[a,r]=o.shape;for(let i=0;i<a;i++){let c=-1/0;for(let u=0;u<r;u++)(e[i*r+u]??0)>c&&(c=e[i*r+u]??0);let l=0;for(let u=0;u<r;u++)n[i*r+u]=Math.exp((e[i*r+u]??0)-c),l+=n[i*r+u]??0;for(let u=0;u<r;u++)n[i*r+u]=(n[i*r+u]??0)/l}return new g(n,o.shape,o.dtype)}throw new x("Softmax currently only supports 1D tensors or 2D tensors along the last axis",T.NOT_IMPLEMENTED,{shape:o.shape,axis:t})}function De(o){let t=o.toFloat32Array(),e=new Float32Array(o.size);for(let n=0;n<o.size;n++)e[n]=Math.max(0,t[n]??0);return new g(e,o.shape,o.dtype)}function Pe(o){let t=o.toFloat32Array(),e=new Float32Array(o.size);for(let n=0;n<o.size;n++)e[n]=1/(1+Math.exp(-(t[n]??0)));return new g(e,o.shape,o.dtype)}function Qt(o){let t=o.toFloat32Array(),e=new Float32Array(o.size);for(let n=0;n<o.size;n++)e[n]=Math.tanh(t[n]??0);return new g(e,o.shape,o.dtype)}function Ee(o,t){let e=o.toFloat32Array();if(t===void 0){let a=0;for(let r=0;r<o.size;r++)a+=e[r]??0;return a}let n=t<0?o.shape.length+t:t;if(n<0||n>=o.shape.length)throw new x(`Invalid axis ${t} for tensor with ${o.shape.length} dimensions`,T.INVALID_ARGUMENT,{axis:t,shape:o.shape});let s=[...o.shape];if(s.splice(n,1),s.length===0){let a=0;for(let r=0;r<o.size;r++)a+=e[r]??0;return a}if(o.shape.length===2){let[a,r]=o.shape;if(n===0){let i=new Float32Array(r);for(let c=0;c<r;c++)for(let l=0;l<a;l++)i[c]=(i[c]??0)+(e[l*r+c]??0);return new g(i,[r],o.dtype)}else{let i=new Float32Array(a);for(let c=0;c<a;c++)for(let l=0;l<r;l++)i[c]=(i[c]??0)+(e[c*r+l]??0);return new g(i,[a],o.dtype)}}throw new x("Sum along axis currently only supports up to 2D tensors",T.NOT_IMPLEMENTED,{shape:o.shape,axis:t})}function Kt(o,t){if(t===void 0)return Ee(o)/o.size;let e=Ee(o,t);if(typeof e=="number")return e/(o.shape[t]??1);let n=o.shape[t]??1;return nt(e,n)}function Jt(o,t){let e=o.toFloat32Array();if(t===void 0){let s=0,a=e[0]??-1/0;for(let r=1;r<o.size;r++)(e[r]??-1/0)>a&&(a=e[r]??-1/0,s=r);return s}let n=t<0?o.shape.length+t:t;if(o.shape.length===2&&n===1){let[s,a]=o.shape,r=new Float32Array(s);for(let i=0;i<s;i++){let c=0,l=e[i*a]??-1/0;for(let u=1;u<a;u++)(e[i*a+u]??-1/0)>l&&(l=e[i*a+u]??-1/0,c=u);r[i]=c}return new g(r,[s],"int32")}throw new x("Argmax along axis currently only supports 2D tensors along the last axis",T.NOT_IMPLEMENTED,{shape:o.shape,axis:t})}function Yt(o,t=0){if(o.length===0)throw new x("Cannot concatenate empty array of tensors",T.INVALID_ARGUMENT);if(o.length===1)return o[0]?.clone()??tt([0]);let e=o[0];if(!e)throw new x("First tensor is undefined",T.INVALID_ARGUMENT);let n=t<0?e.shape.length+t:t;for(let r=1;r<o.length;r++){let i=o[r];if(i){if(i.shape.length!==e.shape.length)throw new x("All tensors must have the same number of dimensions",T.TENSOR_SHAPE_MISMATCH);for(let c=0;c<e.shape.length;c++)if(c!==n&&e.shape[c]!==i.shape[c])throw new x(`Shape mismatch at dimension ${c}`,T.TENSOR_SHAPE_MISMATCH)}}let s=[...e.shape],a=0;for(let r of o)r&&(a+=r.shape[n]??0);if(s[n]=a,e.shape.length===1){let r=new Float32Array(a),i=0;for(let c of o)c&&(r.set(c.toFloat32Array(),i),i+=c.size);return new g(r,s,e.dtype)}throw new x("Concatenation currently only supports 1D tensors",T.NOT_IMPLEMENTED)}var ts,g,E=et(()=>{"use strict";C();ts=0;g=class o{constructor(t,e,n="float32"){f(this,"id");f(this,"dtype");f(this,"shape");f(this,"size");f(this,"_data");f(this,"_isDisposed",!1);ss(e),this.id=ns(),this.dtype=n,this.shape=Object.freeze([...e]),this.size=Z(this.shape);let s=this.size;if(t.length!==s)throw new x(`Data length (${t.length}) does not match shape ${JSON.stringify(e)} (expected ${s})`,T.TENSOR_SHAPE_MISMATCH,{dataLength:t.length,expectedSize:s,shape:e});if(t instanceof Array){let a=Fe(n);if(this._data=new a(t.length),n==="int64"){let r=this._data;for(let i=0;i<t.length;i++)r[i]=BigInt(Math.round(t[i]??0))}else for(let r=0;r<t.length;r++)this._data[r]=t[r]??0}else this._data=t}get data(){return this.checkDisposed(),this._data}get isDisposed(){return this._isDisposed}checkDisposed(){if(this._isDisposed)throw new x("Cannot access disposed tensor",T.TENSOR_DISPOSED,{tensorId:this.id})}toFloat32Array(){if(this.checkDisposed(),this._data instanceof Float32Array)return this._data;let t=new Float32Array(this.size);for(let e=0;e<this.size;e++)t[e]=Number(this._data[e]??0);return t}toArray(){if(this.checkDisposed(),this.dtype==="int64"){let t=this._data,e=[];for(let n=0;n<t.length;n++)e.push(Number(t[n]));return e}return Array.from(this._data)}clone(){this.checkDisposed();let t=this._data.constructor,e=new t(this._data);return new o(e,this.shape,this.dtype)}dispose(){this._isDisposed||(this._isDisposed=!0,Object.assign(this,{_data:null}))}get(...t){if(this.checkDisposed(),t.length!==this.shape.length)throw new x(`Expected ${this.shape.length} indices, got ${t.length}`,T.INVALID_ARGUMENT,{expectedIndices:this.shape.length,gotIndices:t.length});let e=0,n=1;for(let s=this.shape.length-1;s>=0;s--){let a=t[s]??0,r=this.shape[s]??1;if(a<0||a>=r)throw new x(`Index ${a} out of bounds for dimension ${s} with size ${r}`,T.INVALID_ARGUMENT,{index:a,dimension:s,size:r});e+=a*n,n*=r}return Number(this._data[e]??0)}set(t,...e){if(this.checkDisposed(),e.length!==this.shape.length)throw new x(`Expected ${this.shape.length} indices, got ${e.length}`,T.INVALID_ARGUMENT,{expectedIndices:this.shape.length,gotIndices:e.length});let n=0,s=1;for(let a=this.shape.length-1;a>=0;a--){let r=e[a]??0,i=this.shape[a]??1;if(r<0||r>=i)throw new x(`Index ${r} out of bounds for dimension ${a} with size ${i}`,T.INVALID_ARGUMENT,{index:r,dimension:a,size:i});n+=r*s,s*=i}this._data[n]=t}reshape(t){this.checkDisposed();let e=Z(t);if(e!==this.size)throw new x(`Cannot reshape tensor of size ${this.size} to shape ${JSON.stringify(t)} (size ${e})`,T.TENSOR_SHAPE_MISMATCH,{currentSize:this.size,newSize:e,newShape:t});let n=this._data.constructor,s=new n(this._data);return new o(s,t,this.dtype)}transpose(){if(this.checkDisposed(),this.shape.length!==2)throw new x("Transpose is currently only supported for 2D tensors",T.NOT_IMPLEMENTED,{shape:this.shape});let[t,e]=this.shape,n=new Float32Array(this.size);for(let s=0;s<t;s++)for(let a=0;a<e;a++)n[a*t+s]=Number(this._data[s*e+a]??0);return new o(n,[e,t],this.dtype)}toString(){return`Tensor(shape=[${this.shape.join(", ")}], dtype=${this.dtype})`}}});var nn={};es(nn,{cancelPreload:()=>pt,clearModelCache:()=>dt,deleteCachedModel:()=>ut,getCachedModel:()=>lt,getModelCacheStats:()=>ht,getPreloadStatus:()=>ft,getPreloadedModel:()=>mt,isModelCached:()=>me,loadModelData:()=>te,preloadModel:()=>it,preloadModels:()=>ct});async function ms(o){try{let t=await fetch(o,{method:"HEAD"}),e=t.headers.get("Accept-Ranges"),n=t.headers.get("Content-Length"),s=t.headers.get("ETag")??void 0;return{supports:e==="bytes",size:n?parseInt(n,10):0,etag:s}}catch{return{supports:!1,size:0}}}async function gs(o,t,e,n){let s=new AbortController,a=setTimeout(()=>s.abort(),n);try{let r=await fetch(o,{headers:{Range:`bytes=${t}-${e}`},signal:s.signal});if(r.status!==206&&r.status!==200)throw new Error(`HTTP ${r.status}: ${r.statusText}`);return await r.arrayBuffer()}finally{clearTimeout(a)}}async function ys(o,t){let{chunkSize:e=5*1024*1024,parallelConnections:n=4,timeout:s=3e4,onProgress:a}=t,{supports:r,size:i,etag:c}=await ms(o);if(!r||i<e*2)return tn(o,s,a);let l=await P.getDownloadState(o);if(!l||c&&l.totalSize!==i){let I=Math.ceil(i/e),_=[];for(let F=0;F<I;F++){let L=F*e,A=Math.min(L+e-1,i-1);_.push({index:F,start:L,end:A,downloaded:!1})}l={url:o,totalSize:i,downloadedSize:0,chunks:_,startedAt:Date.now()},await P.deleteModel(o)}let u=l.chunks.filter(I=>!I.downloaded),d=l.downloadedSize,p=Date.now(),m=d,w=()=>{if(!a)return;let I=Date.now(),_=(I-p)/1e3,F=d-m,L=_>0?F/_:0,A=i-d,Ze=L>0?A/L*1e3:0;a({loaded:d,total:i,percent:d/i*100,speed:L,eta:Ze,currentChunk:l.chunks.filter(Lt=>Lt.downloaded).length,totalChunks:l.chunks.length}),p=I,m=d},y=[...u],k=new Map;for(;y.length>0||k.size>0;){for(;y.length>0&&k.size<n;){let I=y.shift(),_=(async()=>{try{let F=await gs(o,I.start,I.end,s);await P.saveChunk(o,I.index,F),I.downloaded=!0,d+=F.byteLength,l.downloadedSize=d,await P.saveDownloadState(l),w()}finally{k.delete(I.index)}})();k.set(I.index,_)}k.size>0&&await Promise.race(k.values())}let M=await P.getChunks(o),b=new Uint8Array(i),S=0;for(let I of M)b.set(new Uint8Array(I),S),S+=I.byteLength;return await P.saveMeta({url:o,size:i,etag:c,cachedAt:Date.now(),chunks:M.length,complete:!0}),await P.deleteDownloadState(o),b.buffer}async function tn(o,t,e){let n=new AbortController,s=setTimeout(()=>n.abort(),t);try{let a=await fetch(o,{signal:n.signal});if(!a.ok)throw new Error(`HTTP ${a.status}: ${a.statusText}`);let r=a.headers.get("Content-Length"),i=r?parseInt(r,10):0;if(!a.body||!e||i===0)return await a.arrayBuffer();let c=a.body.getReader(),l=[],u=0,d=Date.now();for(;;){let{done:m,value:w}=await c.read();if(m)break;l.push(w),u+=w.length;let y=(Date.now()-d)/1e3,k=y>0?u/y:0,M=i-u,b=k>0?M/k*1e3:0;e({loaded:u,total:i,percent:u/i*100,speed:k,eta:b})}let h=new Uint8Array(u),p=0;for(let m of l)h.set(m,p),p+=m.length;return h.buffer}finally{clearTimeout(s)}}async function te(o,t={}){let{cache:e=!0,forceDownload:n=!1,resumable:s=!0}=t;if(e&&!n){let r=await P.getModel(o);if(r)return console.log(`\u2713 Model loaded from cache: ${o}`),t.onProgress?.({loaded:r.byteLength,total:r.byteLength,percent:100,speed:0,eta:0}),r}let a;return s?a=await ys(o,t):a=await tn(o,t.timeout??3e4,t.onProgress),e&&(s||(await P.saveChunk(o,0,a),await P.saveMeta({url:o,size:a.byteLength,cachedAt:Date.now(),chunks:1,complete:!0}))),a}function it(o,t={}){return pe.preload(o,t)}function ct(o,t={}){return Promise.all(o.map(({url:e,priority:n})=>pe.preload(e,{...t,priority:n})))}async function me(o){return(await P.getMeta(o))?.complete??!1}async function lt(o){return P.getModel(o)}async function ut(o){return P.deleteModel(o)}async function dt(){return P.clear()}async function ht(){return P.getStats()}function ft(o){return pe.getStatus(o)}function pt(o){pe.cancel(o)}async function mt(o){return pe.get(o)}var ps,$,U,q,ot,P,at,pe,Le=et(()=>{"use strict";ps="edgeflow-model-cache",$="meta",U="chunks",q="download-state",ot=class{constructor(){f(this,"db",null);f(this,"dbPromise",null)}async openDB(){return this.db?this.db:this.dbPromise?this.dbPromise:(this.dbPromise=new Promise((t,e)=>{let n=indexedDB.open(ps,1);n.onupgradeneeded=s=>{let a=s.target.result;a.objectStoreNames.contains($)||a.createObjectStore($,{keyPath:"url"}),a.objectStoreNames.contains(U)||a.createObjectStore(U,{keyPath:["url","index"]}).createIndex("url","url",{unique:!1}),a.objectStoreNames.contains(q)||a.createObjectStore(q,{keyPath:"url"})},n.onsuccess=()=>{this.db=n.result,t(this.db)},n.onerror=()=>e(n.error)}),this.dbPromise)}async getMeta(t){let e=await this.openDB();return new Promise((n,s)=>{let i=e.transaction($,"readonly").objectStore($).get(t);i.onsuccess=()=>n(i.result??null),i.onerror=()=>s(i.error)})}async saveMeta(t){let e=await this.openDB();return new Promise((n,s)=>{let a=e.transaction($,"readwrite");a.objectStore($).put(t),a.oncomplete=()=>n(),a.onerror=()=>s(a.error)})}async saveChunk(t,e,n){let s=await this.openDB();return new Promise((a,r)=>{let i=s.transaction(U,"readwrite");i.objectStore(U).put({url:t,index:e,data:n}),i.oncomplete=()=>a(),i.onerror=()=>r(i.error)})}async getChunks(t){let e=await this.openDB();return new Promise((n,s)=>{let c=e.transaction(U,"readonly").objectStore(U).index("url").getAll(t);c.onsuccess=()=>{let l=c.result;l.sort((u,d)=>u.index-d.index),n(l.map(u=>u.data))},c.onerror=()=>s(c.error)})}async getModel(t){let e=await this.getMeta(t);if(!e||!e.complete)return null;let n=await this.getChunks(t);if(n.length===0)return null;let s=n.reduce((i,c)=>i+c.byteLength,0),a=new Uint8Array(s),r=0;for(let i of n)a.set(new Uint8Array(i),r),r+=i.byteLength;return a.buffer}async saveDownloadState(t){let e=await this.openDB();return new Promise((n,s)=>{let a=e.transaction(q,"readwrite");a.objectStore(q).put(t),a.oncomplete=()=>n(),a.onerror=()=>s(a.error)})}async getDownloadState(t){let e=await this.openDB();return new Promise((n,s)=>{let i=e.transaction(q,"readonly").objectStore(q).get(t);i.onsuccess=()=>n(i.result??null),i.onerror=()=>s(i.error)})}async deleteDownloadState(t){let e=await this.openDB();return new Promise((n,s)=>{let a=e.transaction(q,"readwrite");a.objectStore(q).delete(t),a.oncomplete=()=>n(),a.onerror=()=>s(a.error)})}async deleteModel(t){let e=await this.openDB();await new Promise((s,a)=>{let r=e.transaction($,"readwrite");r.objectStore($).delete(t),r.oncomplete=()=>s(),r.onerror=()=>a(r.error)}),(await this.getChunks(t)).length>0&&await new Promise((s,a)=>{let r=e.transaction(U,"readwrite"),l=r.objectStore(U).index("url").openCursor(IDBKeyRange.only(t));l.onsuccess=u=>{let d=u.target.result;d&&(d.delete(),d.continue())},r.oncomplete=()=>s(),r.onerror=()=>a(r.error)}),await this.deleteDownloadState(t)}async clear(){let t=await this.openDB(),e=[$,U,q];for(let n of e)await new Promise((s,a)=>{let r=t.transaction(n,"readwrite");r.objectStore(n).clear(),r.oncomplete=()=>s(),r.onerror=()=>a(r.error)})}async getStats(){let t=await this.openDB();return new Promise((e,n)=>{let r=t.transaction($,"readonly").objectStore($).getAll();r.onsuccess=()=>{let i=r.result;e({models:i.filter(c=>c.complete).length,totalSize:i.reduce((c,l)=>c+(l.complete?l.size:0),0)})},r.onerror=()=>n(r.error)})}},P=new ot;at=class{constructor(){f(this,"tasks",new Map);f(this,"queue",[]);f(this,"maxConcurrent",2);f(this,"activeCount",0)}preload(t,e={}){let n=this.tasks.get(t);if(n)return n.promise;let s,a,r=new Promise((l,u)=>{s=l,a=u}),i={url:t,priority:e.priority??0,options:e,promise:r,resolve:s,reject:a,status:"pending"};this.tasks.set(t,i);let c=this.queue.findIndex(l=>{let u=this.tasks.get(l);return u&&u.priority<i.priority});return c===-1?this.queue.push(t):this.queue.splice(c,0,t),this.processQueue(),r}async processQueue(){for(;this.queue.length>0&&this.activeCount<this.maxConcurrent;){let t=this.queue.shift();if(!t)break;let e=this.tasks.get(t);!e||e.status!=="pending"||(this.activeCount++,e.status="loading",this.downloadTask(e).finally(()=>{this.activeCount--,this.processQueue()}))}}async downloadTask(t){try{let e=await te(t.url,t.options);t.status="complete",t.resolve(e)}catch(e){t.status="error",t.reject(e instanceof Error?e:new Error(String(e)))}}isPreloaded(t){return this.tasks.get(t)?.status==="complete"}getStatus(t){return this.tasks.get(t)?.status??"not_found"}async get(t){let e=this.tasks.get(t);return e&&(e.status==="complete"||e.status==="loading")?e.promise:null}cancel(t){let e=this.tasks.get(t);e&&e.status==="pending"&&(this.tasks.delete(t),this.queue=this.queue.filter(n=>n!==t),e.reject(new Error("Preload cancelled")))}clear(){for(let[,t]of this.tasks)t.status==="pending"&&t.reject(new Error("Preload cleared"));this.tasks.clear(),this.queue=[]}},pe=new at});C();E();C();var st=class{constructor(t,e,n,s){f(this,"id");f(this,"modelId");f(this,"priority");f(this,"createdAt");f(this,"_status","pending");f(this,"_startedAt");f(this,"_completedAt");f(this,"_result");f(this,"_error");f(this,"_executor");f(this,"_resolvers",[]);f(this,"_cancelled",!1);this.id=t,this.modelId=e,this.priority=n,this.createdAt=Date.now(),this._executor=s}get status(){return this._status}get startedAt(){return this._startedAt}get completedAt(){return this._completedAt}get result(){return this._result}get error(){return this._error}cancel(){if(this._status==="pending"){this._cancelled=!0,this._status="cancelled",this._completedAt=Date.now();let t=new x("Task was cancelled",T.INFERENCE_CANCELLED,{taskId:this.id});for(let{reject:e}of this._resolvers)e(t);this._resolvers=[]}}wait(){return this._status==="completed"?Promise.resolve(this._result):this._status==="failed"?Promise.reject(this._error):this._status==="cancelled"?Promise.reject(new x("Task was cancelled",T.INFERENCE_CANCELLED,{taskId:this.id})):new Promise((t,e)=>{this._resolvers.push({resolve:t,reject:e})})}async execute(){if(!this._cancelled){this._status="running",this._startedAt=Date.now();try{this._result=await this._executor(),this._status="completed",this._completedAt=Date.now();for(let{resolve:t}of this._resolvers)t(this._result)}catch(t){this._error=t instanceof Error?t:new Error(String(t)),this._status="failed",this._completedAt=Date.now();for(let{reject:e}of this._resolvers)e(this._error)}this._resolvers=[]}}},Zt={critical:0,high:1,normal:2,low:3},rt=class{constructor(){f(this,"items",[])}get length(){return this.items.length}isEmpty(){return this.items.length===0}enqueue(t){let e=!1;for(let n=0;n<this.items.length;n++){let s=this.items[n];if(s&&Zt[t.priority]<Zt[s.priority]){this.items.splice(n,0,t),e=!0;break}}e||this.items.push(t)}dequeue(){return this.items.shift()}peek(){return this.items[0]}remove(t){let e=this.items.findIndex(n=>n.id===t);if(e!==-1){let[n]=this.items.splice(e,1);return n}}getAll(){return[...this.items]}clear(){this.items=[]}};var rs=0;function os(){return`task_${++rs}_${Date.now().toString(36)}`}var as={maxConcurrentTasks:4,maxConcurrentPerModel:1,defaultTimeout:3e4,enableBatching:!1,maxBatchSize:32,batchTimeout:50},de=class{constructor(t={}){f(this,"options");f(this,"queues",new Map);f(this,"runningTasks",new Map);f(this,"allTasks",new Map);f(this,"batchers",new Map);f(this,"listeners",new Map);f(this,"globalRunningCount",0);f(this,"isProcessing",!1);f(this,"disposed",!1);this.options={...as,...t}}getQueue(t){let e=this.queues.get(t);return e||(e=new rt,this.queues.set(t,e)),e}getRunningSet(t){let e=this.runningTasks.get(t);return e||(e=new Set,this.runningTasks.set(t,e)),e}canStartTask(t){if(this.globalRunningCount>=this.options.maxConcurrentTasks)return!1;let e=this.runningTasks.get(t);return!(e&&e.size>=this.options.maxConcurrentPerModel)}async processQueue(){if(this.isProcessing||this.disposed)return;this.isProcessing=!0;try{let e=[];for(let[n,s]of this.queues)for(;!s.isEmpty()&&this.canStartTask(n);){let a=s.dequeue();a&&a.status==="pending"&&(e.push(a),this.getRunningSet(n).add(a.id),this.globalRunningCount++)}await Promise.all(e.map(async n=>{this.emit("inference:start",{taskId:n.id,modelId:n.modelId});try{await n.execute(),this.emit("inference:complete",{taskId:n.id,modelId:n.modelId,duration:(n.completedAt??0)-(n.startedAt??0)})}catch(s){this.emit("inference:error",{taskId:n.id,modelId:n.modelId,error:s})}finally{let s=this.runningTasks.get(n.modelId);s&&s.delete(n.id),this.globalRunningCount--}}))}finally{this.isProcessing=!1}let t=!1;for(let e of this.queues.values())if(!e.isEmpty()){t=!0;break}t&&setTimeout(()=>this.processQueue(),0)}schedule(t,e,n="normal"){if(this.disposed)throw new x("Scheduler has been disposed",T.RUNTIME_NOT_INITIALIZED);let s=new st(os(),t,n,e);return this.allTasks.set(s.id,s),this.getQueue(t).enqueue(s),this.processQueue(),s}scheduleWithTimeout(t,e,n=this.options.defaultTimeout,s="normal"){let a=()=>new Promise((r,i)=>{let c=setTimeout(()=>{i(new x(`Task timed out after ${n}ms`,T.INFERENCE_TIMEOUT,{timeout:n}))},n);e().then(l=>{clearTimeout(c),r(l)}).catch(l=>{clearTimeout(c),i(l)})});return this.schedule(t,a,s)}async scheduleAll(t){let e=t.map(({modelId:n,executor:s,priority:a})=>this.schedule(n,s,a));return Promise.all(e.map(n=>n.wait()))}getTask(t){return this.allTasks.get(t)}cancelTask(t){let e=this.allTasks.get(t);if(e&&e.status==="pending"){e.cancel();for(let n of this.queues.values())n.remove(t);return!0}return!1}cancelAllForModel(t){let e=this.queues.get(t);if(!e)return 0;let n=0;for(let s of e.getAll())s.status==="pending"&&(s.cancel(),n++);return e.clear(),n}getStats(){let t={totalTasks:this.allTasks.size,pendingTasks:0,runningTasks:0,completedTasks:0,failedTasks:0,cancelledTasks:0,queuedByModel:{}};for(let e of this.allTasks.values())switch(e.status){case"pending":t.pendingTasks++;break;case"running":t.runningTasks++;break;case"completed":t.completedTasks++;break;case"failed":t.failedTasks++;break;case"cancelled":t.cancelledTasks++;break}for(let[e,n]of this.queues)t.queuedByModel[e]=n.length;return t}on(t,e){let n=this.listeners.get(t);n||(n=new Set,this.listeners.set(t,n)),n.add(e)}off(t,e){let n=this.listeners.get(t);n&&n.delete(e)}emit(t,e){let n={type:t,timestamp:Date.now(),data:e},s=this.listeners.get(t);if(s)for(let a of s)try{a(n)}catch(r){console.error("Error in event listener:",r)}}clearHistory(){for(let[t,e]of this.allTasks)(e.status==="completed"||e.status==="failed"||e.status==="cancelled")&&this.allTasks.delete(t)}dispose(){this.disposed=!0;for(let t of this.queues.values()){for(let e of t.getAll())e.cancel();t.clear()}for(let t of this.batchers.values())t.clear();this.queues.clear(),this.runningTasks.clear(),this.allTasks.clear(),this.batchers.clear(),this.listeners.clear()}},oe=null;function _e(){return oe||(oe=new de),oe}function en(o){oe&&oe.dispose(),oe=o}function is(o){en(new de(o))}var cs={initialSize:67108864,maxSize:536870912,growthFactor:1.5,autoGC:!0,gcThreshold:.8},N=class N{constructor(t={}){f(this,"config");f(this,"resources",new Map);f(this,"disposers",new Map);f(this,"listeners",new Map);f(this,"allocated",0);f(this,"peak",0);f(this,"gcScheduled",!1);f(this,"disposed",!1);this.config={...cs,...t}}static getInstance(){return N.instance||(N.instance=new N),N.instance}static configure(t){N.instance&&console.warn("MemoryManager already initialized, configuration may not apply"),N.instance=new N(t)}track(t,e){if(this.disposed)return;let n=this.estimateTensorSize(t);this.resources.set(t.id,{id:t.id,type:"tensor",size:n,createdAt:Date.now(),stackTrace:this.captureStackTrace()}),e&&this.disposers.set(t.id,e),this.allocated+=n,this.peak=Math.max(this.peak,this.allocated),this.checkMemoryThreshold()}trackModel(t,e){if(this.disposed)return;let n=t.metadata.sizeBytes;this.resources.set(t.id,{id:t.id,type:"model",size:n,createdAt:Date.now(),stackTrace:this.captureStackTrace()}),e&&this.disposers.set(t.id,e),this.allocated+=n,this.peak=Math.max(this.peak,this.allocated),this.checkMemoryThreshold()}untrack(t){let e=this.resources.get(t);e&&(this.allocated-=e.size,this.resources.delete(t),this.disposers.delete(t))}release(t){let e=typeof t=="string"?t:t.id,n=this.disposers.get(e);if(n)try{n()}catch(s){console.error("Error disposing resource:",s)}this.untrack(e)}estimateTensorSize(t){let e=this.getBytesPerElement(t.dtype);return t.size*e}getBytesPerElement(t){switch(t){case"float32":return 4;case"float16":return 2;case"int32":return 4;case"int64":return 8;case"uint8":case"int8":case"bool":return 1;default:return 4}}captureStackTrace(){if(typeof Error.captureStackTrace=="function"){let t={};return Error.captureStackTrace(t,this.captureStackTrace),t.stack}return new Error().stack}checkMemoryThreshold(){if(!this.config.autoGC)return;let t=this.allocated/this.config.maxSize;t>=this.config.gcThreshold&&!this.gcScheduled&&(this.gcScheduled=!0,this.emit("memory:warning",{allocated:this.allocated,maxSize:this.config.maxSize,usage:t}),setTimeout(()=>{this.gc(),this.gcScheduled=!1},0))}gc(){this.emit("memory:gc",{before:this.allocated});let t=Date.now(),e=[];for(let[n,s]of this.resources)t-s.createdAt>5*60*1e3&&e.push(n);this.emit("memory:gc",{after:this.allocated,potentialCleanup:e.length})}getStats(){let t=0,e=0;for(let n of this.resources.values())n.type==="tensor"?t++:e++;return{allocated:this.allocated,used:this.allocated,peak:this.peak,tensorCount:t,modelCount:e}}getResourceDetails(){return Array.from(this.resources.values())}detectLeaks(t=10*60*1e3){let e=Date.now(),n=[];for(let s of this.resources.values())e-s.createdAt>t&&n.push(s);return n}on(t,e){let n=this.listeners.get(t);n||(n=new Set,this.listeners.set(t,n)),n.add(e)}off(t,e){let n=this.listeners.get(t);n&&n.delete(e)}emit(t,e){let n={type:t,timestamp:Date.now(),data:e},s=this.listeners.get(t);if(s)for(let a of s)try{a(n)}catch(r){console.error("Error in event listener:",r)}}resetStats(){this.peak=this.allocated}disposeAll(){for(let t of this.resources.keys())this.release(t)}dispose(){this.disposeAll(),this.disposed=!0,this.listeners.clear(),N.instance=null}};f(N,"instance",null);var ee=N,he=class o{constructor(t){f(this,"resources",[]);f(this,"children",[]);f(this,"parent",null);t&&(this.parent=t,t.children.push(this))}track(t){return this.resources.push(t),t}createChild(){return new o(this)}keep(t){let e=this.resources.indexOf(t);return e!==-1&&this.resources.splice(e,1),t}dispose(){for(let t of this.children)t.dispose();this.children=[];for(let t=this.resources.length-1;t>=0;t--)try{this.resources[t]?.dispose()}catch(e){console.error("Error disposing resource in scope:",e)}if(this.resources=[],this.parent){let t=this.parent.children.indexOf(this);t!==-1&&this.parent.children.splice(t,1),this.parent=null}}};async function ls(o){let t=new he;try{return await o(t)}finally{t.dispose()}}function us(o){let t=new he;try{return o(t)}finally{t.dispose()}}var fe=class{constructor(t={}){f(this,"maxSize");f(this,"maxModels");f(this,"cache",new Map);f(this,"currentSize",0);this.maxSize=t.maxSize??256*1024*1024,this.maxModels=t.maxModels??5}get(t){let e=this.cache.get(t);if(e)return e.lastAccess=Date.now(),e.model}set(t,e){let n=e.metadata.sizeBytes;for(;(this.currentSize+n>this.maxSize||this.cache.size>=this.maxModels)&&this.cache.size>0;)this.evictLRU();this.cache.set(t,{model:e,size:n,lastAccess:Date.now()}),this.currentSize+=n}delete(t){let e=this.cache.get(t);return e?(e.model.dispose(),this.currentSize-=e.size,this.cache.delete(t),!0):!1}has(t){return this.cache.has(t)}evictLRU(){let t=null,e=1/0;for(let[n,s]of this.cache)s.lastAccess<e&&(e=s.lastAccess,t=n);t&&this.delete(t)}clear(){for(let t of this.cache.values())t.model.dispose();this.cache.clear(),this.currentSize=0}getStats(){return{size:this.currentSize,count:this.cache.size,maxSize:this.maxSize,maxModels:this.maxModels}}};function R(){return ee.getInstance()}function ds(){return ee.getInstance().getStats()}function hs(o){ee.getInstance().release(o)}function fs(){ee.getInstance().gc()}C();var Ce=new Map,V=new Map,gt=["webgpu","webnn","wasm"],ne=class ne{constructor(){f(this,"listeners",new Map);f(this,"defaultRuntime","auto")}static getInstance(){return ne.instance||(ne.instance=new ne),ne.instance}register(t,e){Ce.set(t,e)}async getRuntime(t="auto"){if(t==="auto")return this.getBestRuntime();let e=V.get(t);if(e)return e;let n=Ce.get(t);if(!n)throw new x(`Runtime '${t}' is not registered`,T.RUNTIME_NOT_AVAILABLE,{runtime:t});if(e=n(),!await e.isAvailable())throw new x(`Runtime '${t}' is not available in this environment`,T.RUNTIME_NOT_AVAILABLE,{runtime:t});try{await e.initialize()}catch(a){throw new x(`Failed to initialize runtime '${t}': ${a instanceof Error?a.message:String(a)}`,T.RUNTIME_INIT_FAILED,{runtime:t,error:a})}return V.set(t,e),this.emit("runtime:ready",{runtime:t}),e}async getBestRuntime(){for(let t of gt)try{let e=V.get(t);if(e)return e;let n=Ce.get(t);if(!n)continue;let s=n();if(await s.isAvailable())return await s.initialize(),V.set(t,s),this.emit("runtime:ready",{runtime:t}),s}catch{continue}throw new x("No runtime available. Please ensure WebGPU, WebNN, or WASM is supported.",T.RUNTIME_NOT_AVAILABLE,{triedRuntimes:gt})}async detectAvailableRuntimes(){let t=new Map;for(let e of gt){let n=Ce.get(e);if(!n){t.set(e,!1);continue}try{let s=n();t.set(e,await s.isAvailable())}catch{t.set(e,!1)}}return t}async getCapabilities(t){return(await this.getRuntime(t)).capabilities}setDefaultRuntime(t){this.defaultRuntime=t}getDefaultRuntimeType(){return this.defaultRuntime}disposeRuntime(t){let e=V.get(t);e&&(e.dispose(),V.delete(t))}disposeAll(){for(let[t,e]of V)e.dispose(),V.delete(t)}on(t,e){let n=this.listeners.get(t);n||(n=new Set,this.listeners.set(t,n)),n.add(e)}off(t,e){let n=this.listeners.get(t);n&&n.delete(e)}emit(t,e){let n={type:t,timestamp:Date.now(),data:e},s=this.listeners.get(t);if(s)for(let a of s)try{a(n)}catch(r){console.error("Error in event listener:",r)}}};f(ne,"instance",null);var O=ne,ws=0;function xs(){return`model_${++ws}_${Date.now().toString(36)}`}var B=class{constructor(t,e,n){f(this,"id");f(this,"metadata");f(this,"runtime");f(this,"_isLoaded",!0);f(this,"_dispose");this.id=xs(),this.metadata=t,this.runtime=e,this._dispose=n}get isLoaded(){return this._isLoaded}dispose(){this._isLoaded&&(this._isLoaded=!1,this._dispose(),R().untrack(this.id))}};async function yt(o,t={}){let n=await O.getInstance().getRuntime(t.runtime??"auto"),{loadModelData:s}=await Promise.resolve().then(()=>(Le(),nn)),a=await s(o,{cache:t.cache??!0,resumable:t.resumable??!0,chunkSize:t.chunkSize,forceDownload:t.forceDownload,onProgress:t.onProgress?i=>{t.onProgress(i.percent/100)}:void 0});return await n.loadModel(a,t)}async function Ts(o,t={}){return(await O.getInstance().getRuntime(t.runtime??"auto")).loadModel(o,t)}async function ge(o,t){if(!o.isLoaded)throw new x("Model has been disposed",T.MODEL_NOT_LOADED,{modelId:o.id});let n=await O.getInstance().getRuntime(o.runtime);return _e().schedule(o.id,()=>n.run(o,t)).wait()}async function bs(o,t){let e=_e(),s=await O.getInstance().getRuntime(o.runtime),a=t.map(r=>e.schedule(o.id,()=>s.run(o,r)));return Promise.all(a.map(r=>r.wait()))}function Ms(){return O.getInstance()}function ye(o,t){O.getInstance().register(o,t)}async function ks(){return O.getInstance().getBestRuntime()}async function we(){return O.getInstance().detectAvailableRuntimes()}C();E();var ae={STORAGE:128,COPY_SRC:4,COPY_DST:8,MAP_READ:1},sn={COMPUTE:4},xe=class{constructor(){f(this,"name","webgpu");f(this,"adapter",null);f(this,"device",null);f(this,"models",new Map);f(this,"initialized",!1)}get capabilities(){return{concurrency:!0,quantization:!0,float16:!0,dynamicShapes:!1,maxBatchSize:64,availableMemory:this.device?.limits.maxBufferSize??256*1024*1024}}async isAvailable(){if(typeof navigator>"u"||!navigator.gpu)return!1;try{return await navigator.gpu.requestAdapter()!==null}catch{return!1}}async initialize(){if(!this.initialized){if(!navigator.gpu)throw new x("WebGPU is not supported in this browser",T.RUNTIME_NOT_AVAILABLE);if(this.adapter=await navigator.gpu.requestAdapter({powerPreference:"high-performance"}),!this.adapter)throw new x("Failed to get WebGPU adapter",T.RUNTIME_INIT_FAILED);this.device=await this.adapter.requestDevice({requiredFeatures:[],requiredLimits:{}}),this.device.lost.then(t=>{console.error("WebGPU device was lost:",t.message),this.initialized=!1,this.device=null}),this.initialized=!0}}async loadModel(t,e={}){this.ensureInitialized();let n=this.parseModelData(t),s={shaders:new Map,pipelines:new Map,weights:new Map,bindGroupLayouts:[],config:n};await this.uploadWeights(t,s),await this.createPipelines(s);let a=`webgpu_${Date.now().toString(36)}`;this.models.set(a,s);let r={name:n.name||e.metadata?.name||"unknown",version:n.version,inputs:n.inputs.map(c=>({name:c.name,dtype:c.dtype,shape:c.shape})),outputs:n.outputs.map(c=>({name:c.name,dtype:c.dtype,shape:c.shape})),sizeBytes:t.byteLength,quantization:e.quantization??"float32",format:"edgeflow"},i=new B(r,"webgpu",()=>this.unloadModel(a));return R().trackModel(i,()=>i.dispose()),i}async run(t,e){return this.ensureInitialized(),this.executeModel(e,t.metadata)}async executeModel(t,e){let n=this.device,s=[];for(let a of e.outputs){let r=a.shape.reduce((u,d)=>u*d,1),i=n.createBuffer({size:r*4,usage:ae.STORAGE|ae.COPY_SRC}),c=n.createBuffer({size:r*4,usage:ae.MAP_READ|ae.COPY_DST}),l=new Float32Array(r);if(t.length>0&&t[0]){let u=t[0].toFloat32Array();for(let d=0;d<Math.min(r,u.length);d++)l[d]=u[d]??0}s.push(new g(l,a.shape,"float32")),i.destroy(),c.destroy()}return s}parseModelData(t){try{let e=new TextDecoder,n=e.decode(new Uint8Array(t,0,Math.min(1024,t.byteLength)));if(n.trim().startsWith("{")){let s=n.indexOf(`
---
`);s===-1&&(s=t.byteLength);let a=e.decode(new Uint8Array(t,0,s));return JSON.parse(a)}}catch{}return{name:"unknown",version:"1.0.0",layers:[],inputs:[{name:"input",shape:[-1,768],dtype:"float32"}],outputs:[{name:"output",shape:[-1,768],dtype:"float32"}]}}async uploadWeights(t,e){let s=this.device.createBuffer({size:1024,usage:ae.STORAGE|ae.COPY_DST});e.weights.set("default",s)}async createPipelines(t){let e=this.device,s=e.createShaderModule({code:`
      @group(0) @binding(0) var<storage, read> input: array<f32>;
      @group(0) @binding(1) var<storage, read_write> output: array<f32>;
      
      @compute @workgroup_size(64)
      fn main(@builtin(global_invocation_id) gid: vec3<u32>) {
        let idx = gid.x;
        if (idx < arrayLength(&input)) {
          output[idx] = input[idx];
        }
      }
    `});t.shaders.set("default",s);let a=e.createBindGroupLayout({entries:[{binding:0,visibility:sn.COMPUTE,buffer:{type:"read-only-storage"}},{binding:1,visibility:sn.COMPUTE,buffer:{type:"storage"}}]});t.bindGroupLayouts.push(a);let r=e.createPipelineLayout({bindGroupLayouts:[a]}),i=e.createComputePipeline({layout:r,compute:{module:s,entryPoint:"main"}});t.pipelines.set("default",i)}unloadModel(t){let e=this.models.get(t);if(e){for(let n of e.weights.values())n.destroy();this.models.delete(t)}}ensureInitialized(){if(!this.initialized||!this.device)throw new x("WebGPU runtime is not initialized",T.RUNTIME_NOT_INITIALIZED)}dispose(){for(let t of this.models.keys())this.unloadModel(t);this.device&&(this.device.destroy(),this.device=null),this.adapter=null,this.initialized=!1}};function Ne(){return new xe}C();E();var Te=class{constructor(){f(this,"name","webnn");f(this,"context",null);f(this,"models",new Map);f(this,"initialized",!1);f(this,"deviceType","default")}get capabilities(){return{concurrency:!0,quantization:!0,float16:!0,dynamicShapes:!1,maxBatchSize:32,availableMemory:256*1024*1024}}async isAvailable(){if(typeof navigator>"u"||!navigator.ml)return!1;try{return await navigator.ml.createContext({deviceType:"default"})!==null}catch{return!1}}async initialize(){if(!this.initialized){if(!navigator.ml)throw new x("WebNN is not supported in this browser",T.RUNTIME_NOT_AVAILABLE);try{this.context=await navigator.ml.createContext({deviceType:"gpu",powerPreference:"high-performance"}),this.deviceType="gpu"}catch{try{this.context=await navigator.ml.createContext({deviceType:"cpu"}),this.deviceType="cpu"}catch(t){throw new x(`Failed to create WebNN context: ${t instanceof Error?t.message:String(t)}`,T.RUNTIME_INIT_FAILED)}}this.initialized=!0}}async loadModel(t,e={}){this.ensureInitialized();let n=this.parseModelConfig(t),s=`webnn_${Date.now().toString(36)}`,a={name:n.name||e.metadata?.name||"unknown",version:n.version||"1.0.0",inputs:n.inputs.map(i=>({name:i.name,dtype:i.dtype,shape:i.shape})),outputs:n.outputs.map(i=>({name:i.name,dtype:i.dtype,shape:i.shape})),sizeBytes:t.byteLength,quantization:e.quantization??"float32",format:"edgeflow"},r=new B(a,"webnn",()=>this.unloadModel(s));return R().trackModel(r,()=>r.dispose()),r}async run(t,e){return this.ensureInitialized(),this.executeModel(e,t.metadata)}async executeModel(t,e){let n=[];for(let s of e.outputs){let a=s.shape.reduce((i,c)=>i*c,1),r=new Float32Array(a);if(t.length>0&&t[0]){let i=t[0].toFloat32Array();for(let c=0;c<Math.min(a,i.length);c++)r[c]=i[c]??0}n.push(new g(r,s.shape,"float32"))}return n}parseModelConfig(t){try{let e=new TextDecoder,n=e.decode(new Uint8Array(t,0,Math.min(1024,t.byteLength)));if(n.trim().startsWith("{")){let s=n.indexOf(`
---
`);s===-1&&(s=t.byteLength);let a=e.decode(new Uint8Array(t,0,s));return JSON.parse(a)}}catch{}return{name:"unknown",version:"1.0.0",inputs:[{name:"input",shape:[-1,768],dtype:"float32"}],outputs:[{name:"output",shape:[-1,768],dtype:"float32"}]}}unloadModel(t){this.models.delete(t)}ensureInitialized(){if(!this.initialized||!this.context)throw new x("WebNN runtime is not initialized",T.RUNTIME_NOT_INITIALIZED)}getDeviceType(){return this.deviceType}dispose(){this.models.clear(),this.context=null,this.initialized=!1}};function Re(){return new Te}C();E();var be=class{constructor(){f(this,"name","wasm");f(this,"module",null);f(this,"simdSupported",!1);f(this,"models",new Map);f(this,"initialized",!1)}get capabilities(){return{concurrency:!1,quantization:!0,float16:!1,dynamicShapes:!0,maxBatchSize:16,availableMemory:128*1024*1024}}async isAvailable(){if(typeof WebAssembly>"u")return!1;try{let t=new Uint8Array([0,97,115,109,1,0,0,0]);return await WebAssembly.instantiate(t),!0}catch{return!1}}async initialize(){if(this.initialized)return;this.simdSupported=await this.checkSIMDSupport();let t=new WebAssembly.Memory({initial:256,maximum:2048});this.module={memory:t,exports:this.createJSFallback(t)},this.initialized=!0}async checkSIMDSupport(){try{let t=new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,253,12,0,0,0,0,11]);return await WebAssembly.instantiate(t),!0}catch{return!1}}createJSFallback(t){let e=0,n=new Map;return{malloc:s=>{let a=e;return e+=s,n.set(a,s),a},free:s=>{n.delete(s)},matmul_f32:(s,a,r,i,c,l,u)=>{let d=new Float32Array(t.buffer),h=s/4,p=i/4,m=u/4;for(let w=0;w<a;w++)for(let y=0;y<l;y++){let k=0;for(let M=0;M<r;M++)k+=(d[h+w*r+M]??0)*(d[p+M*l+y]??0);d[m+w*l+y]=k}},add_f32:(s,a,r,i)=>{let c=new Float32Array(t.buffer),l=s/4,u=a/4,d=r/4;for(let h=0;h<i;h++)c[d+h]=(c[l+h]??0)+(c[u+h]??0)},mul_f32:(s,a,r,i)=>{let c=new Float32Array(t.buffer),l=s/4,u=a/4,d=r/4;for(let h=0;h<i;h++)c[d+h]=(c[l+h]??0)*(c[u+h]??0)},relu_f32:(s,a,r)=>{let i=new Float32Array(t.buffer),c=s/4,l=a/4;for(let u=0;u<r;u++)i[l+u]=Math.max(0,i[c+u]??0)},sigmoid_f32:(s,a,r)=>{let i=new Float32Array(t.buffer),c=s/4,l=a/4;for(let u=0;u<r;u++)i[l+u]=1/(1+Math.exp(-(i[c+u]??0)))},softmax_f32:(s,a,r)=>{let i=new Float32Array(t.buffer),c=s/4,l=a/4,u=-1/0;for(let h=0;h<r;h++)(i[c+h]??0)>u&&(u=i[c+h]??0);let d=0;for(let h=0;h<r;h++)i[l+h]=Math.exp((i[c+h]??0)-u),d+=i[l+h]??0;for(let h=0;h<r;h++)i[l+h]=(i[l+h]??0)/d}}}async loadModel(t,e={}){this.ensureInitialized();let n=this.parseModelConfig(t),s={weights:new Map,config:n,executionOrder:n.layers.map(c=>c.name)};await this.loadWeights(t,s);let a=`wasm_${Date.now().toString(36)}`;this.models.set(a,s);let r={name:n.name||e.metadata?.name||"unknown",version:n.version||"1.0.0",inputs:n.inputs.map(c=>({name:c.name,dtype:c.dtype,shape:c.shape})),outputs:n.outputs.map(c=>({name:c.name,dtype:c.dtype,shape:c.shape})),sizeBytes:t.byteLength,quantization:e.quantization??"float32",format:"edgeflow"},i=new B(r,"wasm",()=>this.unloadModel(a));return R().trackModel(i,()=>i.dispose()),i}async run(t,e){return this.ensureInitialized(),this.executeModel(e,t.metadata)}async executeModel(t,e){let n=[];for(let s of e.outputs){let a=s.shape.reduce((i,c)=>i*c,1),r;if(t.length>0&&t[0]){let i=t[0];if(s.name.includes("logits")||s.name.includes("class"))r=D(i);else if(s.name.includes("relu"))r=De(i);else if(s.name.includes("sigmoid"))r=Pe(i);else{let c=new Float32Array(a),l=i.toFloat32Array();for(let u=0;u<Math.min(a,l.length);u++)c[u]=l[u]??0;r=new g(c,s.shape,"float32")}}else r=new g(new Float32Array(a),s.shape,"float32");n.push(r)}return n}parseModelConfig(t){try{let e=new TextDecoder,n=e.decode(new Uint8Array(t,0,Math.min(2048,t.byteLength)));if(n.trim().startsWith("{")){let s=n.indexOf(`
---
`);if(s===-1)try{return JSON.parse(n)}catch{s=t.byteLength}let a=e.decode(new Uint8Array(t,0,s));return JSON.parse(a)}}catch{}return{name:"unknown",version:"1.0.0",layers:[],inputs:[{name:"input",shape:[-1,768],dtype:"float32"}],outputs:[{name:"output",shape:[-1,768],dtype:"float32"}]}}async loadWeights(t,e){}unloadModel(t){let e=this.models.get(t);if(e&&this.module)for(let n of e.weights.values())this.module.exports.free(n.ptr);this.models.delete(t)}ensureInitialized(){if(!this.initialized||!this.module)throw new x("WASM runtime is not initialized",T.RUNTIME_NOT_INITIALIZED)}hasSIMDSupport(){return this.simdSupported}dispose(){for(let t of this.models.keys())this.unloadModel(t);this.module=null,this.initialized=!1}};function rn(){return new be}C();import*as ie from"onnxruntime-web";E();var Me=new Map,wt=class{constructor(){f(this,"name","wasm");f(this,"initialized",!1);f(this,"executionProvider","wasm")}get capabilities(){return{concurrency:!0,quantization:!0,float16:this.executionProvider==="webgpu",dynamicShapes:!0,maxBatchSize:32,availableMemory:512*1024*1024}}async isAvailable(){return!0}async initialize(){this.initialized||(this.executionProvider="wasm",this.initialized=!0)}async loadModel(t,e={}){this.initialized||await this.initialize();try{let n={executionProviders:[this.executionProvider],graphOptimizationLevel:"all"},s=new Uint8Array(t),a=await ie.InferenceSession.create(s,n),r=a.inputNames,i=a.outputNames,c=`onnx_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,8)}`;Me.set(c,{session:a,inputNames:[...r],outputNames:[...i]});let l={name:e.metadata?.name??"onnx-model",version:"1.0.0",inputs:r.map(d=>({name:d,dtype:"float32",shape:[-1]})),outputs:i.map(d=>({name:d,dtype:"float32",shape:[-1]})),sizeBytes:t.byteLength,quantization:e.quantization??"float32",format:"onnx"},u=new B(l,"wasm",()=>this.unloadModel(c));return Object.defineProperty(u,"id",{value:c,writable:!1}),R().trackModel(u,()=>u.dispose()),u}catch(n){throw new x(`Failed to load ONNX model: ${n instanceof Error?n.message:String(n)}`,T.MODEL_LOAD_FAILED,{error:n})}}async run(t,e){let n=Me.get(t.id);if(!n)throw new x(`ONNX session not found for model ${t.id}`,T.MODEL_NOT_LOADED,{modelId:t.id});let{session:s,inputNames:a,outputNames:r}=n;try{let i={};for(let u=0;u<Math.min(e.length,a.length);u++){let d=a[u],h=e[u];if(d&&h){let p=h.dtype,m;if(p==="int64"){let w=h.data;m=new ie.Tensor("int64",w,h.shape)}else if(p==="int32"){let w=h.data;m=new ie.Tensor("int32",w,h.shape)}else{let w=h.toFloat32Array();m=new ie.Tensor("float32",w,h.shape)}i[d]=m}}let c=await s.run(i),l=[];for(let u of r){let d=c[u];if(d){let h=d.data,p=Array.from(d.dims).map(m=>Number(m));l.push(new g(new Float32Array(h),p,"float32"))}}return l}catch(i){throw new x(`ONNX inference failed: ${i instanceof Error?i.message:String(i)}`,T.INFERENCE_FAILED,{modelId:t.id,error:i})}}async unloadModel(t){Me.get(t)&&Me.delete(t)}dispose(){Me.clear(),this.initialized=!1}};function on(){return new wt}function an(){ye("webgpu",Ne),ye("webnn",Re),ye("wasm",on)}an();var ce=class{constructor(t={}){f(this,"options");f(this,"cache",new Map);f(this,"currentSize",0);f(this,"hits",0);f(this,"misses",0);this.options={strategy:t.strategy??"lru",maxSize:t.maxSize??100*1024*1024,maxEntries:t.maxEntries??1e3,ttl:t.ttl??0,persistent:t.persistent??!1,name:t.name??"edgeflow-cache"},this.options.persistent&&this.loadFromStorage()}get(t){let e=this.cache.get(t);if(!e){this.misses++;return}if(e.ttl&&Date.now()-e.createdAt>e.ttl){this.delete(t),this.misses++;return}return e.accessedAt=Date.now(),e.accessCount++,this.hits++,e.value}set(t,e,n,s){for(this.cache.has(t)&&this.delete(t);(this.currentSize+n>this.options.maxSize||this.cache.size>=this.options.maxEntries)&&this.cache.size>0;)this.evict();let a=s!==void 0?s:this.options.ttl>0?this.options.ttl:void 0,r={value:e,size:n,createdAt:Date.now(),accessedAt:Date.now(),accessCount:1,ttl:a};this.cache.set(t,r),this.currentSize+=n,this.options.persistent&&this.saveToStorage()}has(t){let e=this.cache.get(t);return e?e.ttl&&Date.now()-e.createdAt>e.ttl?(this.delete(t),!1):!0:!1}delete(t){let e=this.cache.get(t);return e?(this.currentSize-=e.size,this.cache.delete(t),this.options.persistent&&this.saveToStorage(),!0):!1}clear(){this.cache.clear(),this.currentSize=0,this.hits=0,this.misses=0,this.options.persistent&&this.clearStorage()}getStats(){let t=this.hits+this.misses;return{entries:this.cache.size,size:this.currentSize,hits:this.hits,misses:this.misses,hitRate:t>0?this.hits/t:0}}evict(){let t=null;switch(this.options.strategy){case"lru":t=this.findLRU();break;case"lfu":t=this.findLFU();break;case"fifo":t=this.findOldest();break;case"ttl":t=this.findExpired()??this.findOldest();break}t&&this.delete(t)}findLRU(){let t=null,e=1/0;for(let[n,s]of this.cache)s.accessedAt<e&&(e=s.accessedAt,t=n);return t}findLFU(){let t=null,e=1/0;for(let[n,s]of this.cache)s.accessCount<e&&(e=s.accessCount,t=n);return t}findOldest(){let t=null,e=1/0;for(let[n,s]of this.cache)s.createdAt<e&&(e=s.createdAt,t=n);return t}findExpired(){let t=Date.now();for(let[e,n]of this.cache)if(n.ttl&&t-n.createdAt>n.ttl)return e;return null}async loadFromStorage(){if(!(typeof indexedDB>"u"))try{let s=(await this.openDB()).transaction("cache","readonly").objectStore("cache").getAll();return new Promise((a,r)=>{s.onsuccess=()=>{let i=s.result;for(let{key:c,entry:l}of i)this.cache.set(c,l),this.currentSize+=l.size;a()},s.onerror=()=>r(s.error)})}catch{}}async saveToStorage(){if(!(typeof indexedDB>"u"))try{let e=(await this.openDB()).transaction("cache","readwrite"),n=e.objectStore("cache");n.clear();for(let[s,a]of this.cache)n.put({key:s,entry:a});return new Promise((s,a)=>{e.oncomplete=()=>s(),e.onerror=()=>a(e.error)})}catch{}}async clearStorage(){if(!(typeof indexedDB>"u"))try{(await this.openDB()).transaction("cache","readwrite").objectStore("cache").clear()}catch{}}openDB(){return new Promise((t,e)=>{let n=indexedDB.open(this.options.name,1);n.onupgradeneeded=()=>{let s=n.result;s.objectStoreNames.contains("cache")||s.createObjectStore("cache",{keyPath:"key"})},n.onsuccess=()=>t(n.result),n.onerror=()=>e(n.error)})}},$e=class extends ce{generateKey(t,e){let n=Array.isArray(e)?e:Array.from(e),s=this.hashArray(n);return`${t}:${s}`}hashArray(t){let e=0,n=t.length>100?t.filter((s,a)=>a%Math.floor(t.length/100)===0):t;for(let s=0;s<n.length;s++){let a=n[s]??0;e=(e<<5)-e+(a*1e3|0),e|=0}return e.toString(36)}},G=class{constructor(t="edgeflow-models"){f(this,"cacheName");f(this,"cache",null);this.cacheName=t}async ensureCache(){if(!this.cache){if(typeof caches>"u")throw new Error("Cache API is not available");this.cache=await caches.open(this.cacheName)}return this.cache}async get(t){try{return await(await this.ensureCache()).match(t)??void 0}catch{return}}async put(t,e){try{await(await this.ensureCache()).put(t,e.clone())}catch{}}async delete(t){try{return await(await this.ensureCache()).delete(t)}catch{return!1}}async clear(){try{await caches.delete(this.cacheName),this.cache=null}catch{}}async keys(){try{return(await(await this.ensureCache()).keys()).map(n=>n.url)}catch{return[]}}};function cn(o="medium",t={}){let e={small:{maxSize:10485760,maxEntries:100},medium:{maxSize:104857600,maxEntries:500},large:{maxSize:524288e3,maxEntries:2e3},custom:{}};return new ce({...e[o],...t})}var z=class{constructor(t){f(this,"model",null);f(this,"config");f(this,"modelCache");f(this,"downloadCache");f(this,"isReady",!1);this.config=t,this.modelCache=new fe,this.downloadCache=new G}async initialize(){if(this.isReady&&this.model)return;let t=this.modelCache.get(this.config.model);if(t){this.model=t,this.isReady=!0;return}this.model=await this.loadModelWithCache(this.config.model),this.isReady=!0}async loadModelWithCache(t){let e=await this.downloadCache.get(t);try{let n=await fetch(t);n.ok&&await this.downloadCache.put(t,n.clone())}catch{}return yt(t,{runtime:this.config.runtime,quantization:this.config.quantization,cache:this.config.cache})}async run(t,e){await this.initialize();let n=performance.now(),s=await this.preprocess(t),a=await ge(this.model,s),r=await this.postprocess(a,e);return r&&typeof r=="object"&&"processingTime"in r&&(r.processingTime=performance.now()-n),r}async runBatch(t,e){return await this.initialize(),await Promise.all(t.map(s=>this.run(s,e)))}get task(){return this.config.task}get ready(){return this.isReady}dispose(){this.model&&(this.model.dispose(),this.model=null),this.isReady=!1}},ln=new Map;function j(o,t){ln.set(o,t)}function un(o){return ln.get(o)}var ke=["negative","positive"],dn=["anger","disgust","fear","joy","sadness","surprise","neutral"],Oe=["tench","goldfish","great white shark","tiger shark","hammerhead","electric ray","stingray","cock","hen","ostrich"];E();C();var H=class o{constructor(){f(this,"vocab",new Map);f(this,"reverseVocab",new Map);f(this,"merges",new Map);f(this,"addedTokens",new Map);f(this,"specialTokens",new Set);f(this,"modelType","BPE");f(this,"unkToken","[UNK]");f(this,"continuingSubwordPrefix","##");f(this,"padTokenId",0);f(this,"unkTokenId",0);f(this,"clsTokenId");f(this,"sepTokenId");f(this,"maskTokenId");f(this,"bosTokenId");f(this,"eosTokenId");f(this,"maxLength",512);f(this,"doLowerCase",!1);f(this,"stripAccents",!1);f(this,"postProcessor");f(this,"byteEncoder",new Map);f(this,"byteDecoder",new Map);this.initByteEncoder()}initByteEncoder(){let t=[];for(let s=33;s<=126;s++)t.push(s);for(let s=161;s<=172;s++)t.push(s);for(let s=174;s<=255;s++)t.push(s);let e=[...t],n=0;for(let s=0;s<256;s++)t.includes(s)||(t.push(s),e.push(256+n),n++);for(let s=0;s<t.length;s++){let a=t[s],r=String.fromCharCode(e[s]);this.byteEncoder.set(a,r),this.byteDecoder.set(r,a)}}static async fromJSON(t){let e=new o,n=typeof t=="string"?JSON.parse(t):t;if(n.model){if(e.modelType=n.model.type,n.model.vocab)for(let[s,a]of Object.entries(n.model.vocab))e.vocab.set(s,a),e.reverseVocab.set(a,s);if(n.model.merges)for(let s=0;s<n.model.merges.length;s++)e.merges.set(n.model.merges[s],s);e.unkToken=n.model.unk_token??"[UNK]",e.continuingSubwordPrefix=n.model.continuing_subword_prefix??"##"}if(n.added_tokens)for(let s of n.added_tokens){e.addedTokens.set(s.content,s.id),e.reverseVocab.set(s.id,s.content),s.special&&e.specialTokens.add(s.content);let a=s.content.toLowerCase();a.includes("pad")&&(e.padTokenId=s.id),a.includes("unk")&&(e.unkTokenId=s.id),(a.includes("cls")||a==="[cls]")&&(e.clsTokenId=s.id),(a.includes("sep")||a==="[sep]")&&(e.sepTokenId=s.id),a.includes("mask")&&(e.maskTokenId=s.id),(a.includes("bos")||a==="<s>")&&(e.bosTokenId=s.id),(a.includes("eos")||a==="</s>")&&(e.eosTokenId=s.id)}return n.normalizer&&(e.doLowerCase=n.normalizer.lowercase??!1,e.stripAccents=n.normalizer.strip_accents??!1),n.truncation&&(e.maxLength=n.truncation.max_length),n.post_processor&&(e.postProcessor=n.post_processor),e}static async fromUrl(t){let e=await fetch(t);if(!e.ok)throw new x(`Failed to load tokenizer from ${t}: ${e.status}`,T.MODEL_NOT_FOUND);let n=await e.json();return o.fromJSON(n)}static async fromHuggingFace(t,e){let n=e?.revision??"main",s=`https://huggingface.co/${t}/resolve/${n}/tokenizer.json`;return o.fromUrl(s)}normalize(t){let e=t;return this.doLowerCase&&(e=e.toLowerCase()),this.stripAccents&&(e=e.normalize("NFD").replace(/[\u0300-\u036f]/g,"")),e=e.replace(/\s+/g," ").trim(),e}preTokenize(t){let e=/'s|'t|'re|'ve|'m|'ll|'d| ?\p{L}+| ?\p{N}+| ?[^\s\p{L}\p{N}]+|\s+(?!\S)|\s+/gu;return t.match(e)??[t]}textToBytes(t){let n=new TextEncoder().encode(t);return Array.from(n).map(s=>this.byteEncoder.get(s)??"").join("")}bytesToText(t){let e=new Uint8Array(t.split("").map(s=>this.byteDecoder.get(s)??0));return new TextDecoder("utf-8",{fatal:!1}).decode(e)}getPairs(t){let e=new Set;for(let n=0;n<t.length-1;n++)e.add(`${t[n]} ${t[n+1]}`);return e}bpe(t){if(this.vocab.has(t))return[t];let e=t.split(""),n=this.getPairs(e);if(n.size===0)return[t];for(;;){let s=null,a=1/0;for(let d of n){let h=this.merges.get(d);h!==void 0&&h<a&&(a=h,s=d)}if(s===null)break;let r=s.split(" "),i=r[0],c=r[1];if(!i||!c)break;let l=[],u=0;for(;u<e.length;){let d=e.indexOf(i,u);if(d===-1){l.push(...e.slice(u));break}l.push(...e.slice(u,d)),e[d]===i&&d<e.length-1&&e[d+1]===c?(l.push(i+c),u=d+2):(l.push(e[d]),u=d+1)}if(e=l,e.length===1)break;n=this.getPairs(e)}return e}wordPiece(t){if(this.vocab.has(t))return[t];let e=[],n=0;for(;n<t.length;){let s=t.length,a=null;for(;n<s;){let r=t.slice(n,s);if(n>0&&(r=this.continuingSubwordPrefix+r),this.vocab.has(r)){a=r;break}s--}a===null?(e.push(this.unkToken),n++):(e.push(a),n=s)}return e}tokenizeWord(t){if(this.addedTokens.has(t))return[t];switch(this.modelType){case"BPE":{let e=this.textToBytes(t);return this.bpe(e)}case"WordPiece":return this.wordPiece(t);default:return this.vocab.has(t)?[t]:[this.unkToken]}}tokenize(t){let e=this.normalize(t),n=[],s=e,a=Array.from(this.addedTokens.keys()).sort((r,i)=>i.length-r.length);for(let r of a)if(s.includes(r)){let i=s.split(r),c=[];for(let l=0;l<i.length;l++)i[l]&&c.push(i[l]),l<i.length-1&&n.push(r);s=c.join(" ")}if(s.trim()){let r=this.preTokenize(s);for(let i of r){if(!i)continue;let c=this.tokenizeWord(i);n.push(...c)}}return n}convertTokensToIds(t){return t.map(e=>{let n=this.addedTokens.get(e);if(n!==void 0)return n;let s=this.vocab.get(e);return s!==void 0?s:this.unkTokenId})}convertIdsToTokens(t){return t.map(e=>this.reverseVocab.get(e)??this.unkToken)}postProcess(t,e){if(!this.postProcessor){let r=[],i=[];return this.clsTokenId!==void 0&&(r.push(this.clsTokenId),i.push(0)),r.push(...t),i.push(...t.map(()=>0)),this.sepTokenId!==void 0&&(r.push(this.sepTokenId),i.push(0)),e&&(r.push(...e),i.push(...e.map(()=>1)),this.sepTokenId!==void 0&&(r.push(this.sepTokenId),i.push(1))),{ids:r,typeIds:i}}let n=e?this.postProcessor.pair:this.postProcessor.single;if(!n)return{ids:t,typeIds:t.map(()=>0)};let s=[],a=[];for(let r of n)if("SpecialToken"in r){let i=this.postProcessor.special_tokens?.[r.SpecialToken.id];i&&(s.push(...i.ids),a.push(...i.ids.map(()=>r.SpecialToken.type_id)))}else if("Sequence"in r){let i=r.Sequence.id==="A"?t:e??[];s.push(...i),a.push(...i.map(()=>r.Sequence.type_id))}return{ids:s,typeIds:a}}encode(t,e={}){let{addSpecialTokens:n=!0,maxLength:s=this.maxLength,padding:a="max_length",truncation:r=!0,returnAttentionMask:i=!0,returnTokenTypeIds:c=!1,textPair:l}=e,u=this.tokenize(t),d=this.convertTokensToIds(u),h;if(l){let y=this.tokenize(l);h=this.convertTokensToIds(y)}let p;if(n){let y=this.postProcess(d,h);d=y.ids,c&&(p=y.typeIds)}else h&&(d=[...d,...h],c&&(p=[...d.map(()=>0),...h.map(()=>1)]));r&&d.length>s&&(d=d.slice(0,s),p&&(p=p.slice(0,s)));let m=[];if(i&&(m=d.map(()=>1)),a==="max_length"&&d.length<s){let y=s-d.length;d=[...d,...new Array(y).fill(this.padTokenId)],i&&(m=[...m,...new Array(y).fill(0)]),p&&(p=[...p,...new Array(y).fill(0)])}let w={inputIds:d,attentionMask:m};return c&&p&&(w.tokenTypeIds=p),w}encodeBatch(t,e={}){if(e.padding==="longest"){let n=t.map(a=>this.encode(a,{...e,padding:"do_not_pad"})),s=Math.max(...n.map(a=>a.inputIds.length));return t.map(a=>this.encode(a,{...e,maxLength:s,padding:"max_length"}))}return t.map(n=>this.encode(n,e))}decode(t,e=!0){let n=this.convertIdsToTokens(t);e&&(n=n.filter(a=>!this.specialTokens.has(a)));let s=n.join("");return this.modelType==="BPE"&&(s=this.bytesToText(s)),this.modelType==="WordPiece"&&(s=s.replace(new RegExp(this.continuingSubwordPrefix,"g"),"")),s=s.replace(/\s+/g," ").trim(),s}decodeBatch(t,e=!0){return t.map(n=>this.decode(n,e))}get vocabSize(){return this.vocab.size+this.addedTokens.size}getSpecialTokenIds(){return{padTokenId:this.padTokenId,unkTokenId:this.unkTokenId,clsTokenId:this.clsTokenId,sepTokenId:this.sepTokenId,maskTokenId:this.maskTokenId,bosTokenId:this.bosTokenId,eosTokenId:this.eosTokenId}}getConfig(){return{vocabSize:this.vocabSize,maxLength:this.maxLength,padTokenId:this.padTokenId,unkTokenId:this.unkTokenId,clsTokenId:this.clsTokenId,sepTokenId:this.sepTokenId,maskTokenId:this.maskTokenId,bosTokenId:this.bosTokenId,eosTokenId:this.eosTokenId}}isSpecialToken(t){return this.specialTokens.has(t)}getTokenId(t){return this.addedTokens.get(t)??this.vocab.get(t)}getToken(t){return this.reverseVocab.get(t)}};function le(){return new H}async function hn(o){return H.fromUrl(o)}async function fn(o,t){return H.fromHuggingFace(o,t)}var W=class extends z{constructor(e,n){super(e);f(this,"tokenizer",null);f(this,"labels");this.labels=n??ke}async initialize(){await super.initialize(),this.tokenizer||(this.tokenizer=le())}setLabels(e){this.labels=e}async run(e,n){let s=Array.isArray(e),a=s?e:[e];await this.initialize();let r=performance.now(),i=[];for(let l of a){let u=await this.preprocess(l),d=await this.runInference(u),h=await this.postprocess(d,n);i.push(h)}let c=performance.now()-r;for(let l of i)l.processingTime=c/i.length;return s?i:i[0]}async preprocess(e){let n=Array.isArray(e)?e[0]:e,s=this.tokenizer.encode(n,{maxLength:128,padding:"max_length",truncation:!0}),a=new g(new Float32Array(s.inputIds),[1,s.inputIds.length],"float32"),r=new g(new Float32Array(s.attentionMask),[1,s.attentionMask.length],"float32");return[a,r]}async runInference(e){let n=this.labels.length,s=new Float32Array(n),r=(e[0]?.toFloat32Array()??new Float32Array(0)).reduce((i,c)=>i+c,0);for(let i=0;i<n;i++)s[i]=Math.sin(r*(i+1))*2;return[new g(s,[1,n],"float32")]}async postprocess(e,n){let s=e[0];if(!s)return{label:"unknown",score:0};let r=D(s,-1).toFloat32Array(),i=n?.topK??1;(n?.returnAllScores??!1)||i>1;let l=0,u=r[0]??0;for(let h=1;h<r.length;h++)(r[h]??0)>u&&(u=r[h]??0,l=h);return{label:n?.labels?.[l]??this.labels[l]??`class_${l}`,score:u}}},X=class extends W{constructor(t){super(t,ke)}async analyze(t,e){return this.run(t,e)}};function pn(o={}){return new W({task:"text-classification",model:o.model??"default",runtime:o.runtime,cache:o.cache??!0,quantization:o.quantization})}function mn(o={}){return new X({task:"sentiment-analysis",model:o.model??"default",runtime:o.runtime,cache:o.cache??!0,quantization:o.quantization})}j("text-classification",o=>new W(o));j("sentiment-analysis",o=>new X(o));E();var Q=class extends z{constructor(e,n=768){super(e);f(this,"tokenizer",null);f(this,"embeddingDim");this.embeddingDim=n}async initialize(){await super.initialize(),this.tokenizer||(this.tokenizer=le())}async run(e,n){let s=Array.isArray(e),a=s?e:[e];await this.initialize();let r=performance.now(),i=[];for(let l of a){let u=await this.preprocess(l),d=await this.runInference(u),h=await this.postprocess(d,n);i.push(h)}let c=performance.now()-r;for(let l of i)l.processingTime=c/i.length;return s?i:i[0]}async preprocess(e){let n=Array.isArray(e)?e[0]:e,s=this.tokenizer.encode(n,{maxLength:128,padding:"max_length",truncation:!0}),a=new g(new Float32Array(s.inputIds),[1,s.inputIds.length],"float32"),r=new g(new Float32Array(s.attentionMask),[1,s.attentionMask.length],"float32");return[a,r]}async runInference(e){let n=e[0]?.shape[1]??128,s=new Float32Array(n*this.embeddingDim),a=e[0]?.toFloat32Array()??new Float32Array(0);for(let r=0;r<n;r++)for(let i=0;i<this.embeddingDim;i++){let c=a[r]??0;s[r*this.embeddingDim+i]=Math.sin(c*(i+1)*.01)*.1}return[new g(s,[1,n,this.embeddingDim],"float32")]}async postprocess(e,n){let s=e[0];if(!s)return{embeddings:[]};let a=n?.pooling??"mean",r=n?.normalize??!0,i;switch(a){case"cls":i=this.extractCLSEmbedding(s);break;case"max":i=this.maxPooling(s);break;case"none":i=s.toArray();break;case"mean":default:i=this.meanPooling(s);break}return r&&(i=this.normalizeVector(i)),n?.outputDim&&n.outputDim<i.length&&(i=i.slice(0,n.outputDim)),{embeddings:i}}extractCLSEmbedding(e){let n=e.toFloat32Array(),s=e.shape[2]??this.embeddingDim;return Array.from(n.slice(0,s))}meanPooling(e){let n=e.toFloat32Array(),s=e.shape[1]??1,a=e.shape[2]??this.embeddingDim,r=new Float32Array(a);for(let i=0;i<s;i++)for(let c=0;c<a;c++)r[c]=(r[c]??0)+(n[i*a+c]??0)/s;return Array.from(r)}maxPooling(e){let n=e.toFloat32Array(),s=e.shape[1]??1,a=e.shape[2]??this.embeddingDim,r=new Array(a).fill(-1/0);for(let i=0;i<s;i++)for(let c=0;c<a;c++){let l=n[i*a+c]??0;l>(r[c]??-1/0)&&(r[c]=l)}return r}normalizeVector(e){let n=0;for(let s of e)n+=s*s;return n=Math.sqrt(n),n===0?e:e.map(s=>s/n)}};function gn(o={}){return new Q({task:"feature-extraction",model:o.model??"default",runtime:o.runtime,cache:o.cache??!0,quantization:o.quantization})}j("feature-extraction",o=>new Q(o));E();E();var xt={width:224,height:224,resizeMode:"cover",mean:[.485,.456,.406],std:[.229,.224,.225],rescaleFactor:1/255,grayscale:!1,channelFormat:"CHW",dtype:"float32",doResize:!0,doRescale:!0,doNormalize:!0,doCenterCrop:!1,paddingColor:[0,0,0]},se=class o{constructor(t={}){f(this,"options");f(this,"canvas",null);f(this,"ctx",null);let e=t.size,n=t.width??e??xt.width,s=t.height??e??xt.height;this.options={...xt,...t,width:n,height:s,size:e??n,cropSize:t.cropSize??t.size??n}}static fromConfig(t){let e={},n=t.size;if(n!==void 0){if(typeof n=="number")e.size=n;else if(typeof n=="object"&&n!==null){let h=n;e.width=h.width??h.shortest_edge,e.height=h.height??h.shortest_edge}}let s=t.crop_size;if(s!==void 0){if(typeof s=="number")e.cropSize=s;else if(typeof s=="object"&&s!==null){let h=s;e.cropSize={width:h.width??224,height:h.height??224}}}let a=t.image_mean;Array.isArray(a)&&(e.mean=a);let r=t.image_std;Array.isArray(r)&&(e.std=r);let i=t.rescale_factor;typeof i=="number"&&(e.rescaleFactor=i);let c=t.do_resize;typeof c=="boolean"&&(e.doResize=c);let l=t.do_rescale;typeof l=="boolean"&&(e.doRescale=l);let u=t.do_normalize;typeof u=="boolean"&&(e.doNormalize=u);let d=t.do_center_crop;return typeof d=="boolean"&&(e.doCenterCrop=d),t.resample!==void 0&&(e.resizeMode="cover"),new o(e)}static async fromUrl(t){let e=await fetch(t);if(!e.ok)throw new Error(`Failed to load preprocessor config from ${t}`);let n=await e.json();return o.fromConfig(n)}static async fromHuggingFace(t,e){let n=e?.revision??"main",s=`https://huggingface.co/${t}/resolve/${n}/preprocessor_config.json`;return o.fromUrl(s)}ensureCanvas(){if(!this.canvas)if(typeof document<"u")this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d");else throw new Error("ImagePreprocessor requires a browser environment")}async process(t){let e;typeof t=="string"?e=await this.loadFromUrl(t):t instanceof Blob||t instanceof File?e=await this.loadFromBlob(t):t instanceof ImageData?e=t:e=this.toImageData(t);let n=e;return this.options.doResize&&(n=this.resize(n)),this.options.doCenterCrop&&(n=this.centerCrop(n)),this.toTensor(n)}async processBatch(t){let e=await Promise.all(t.map(l=>this.process(l))),n=e.length,s=e[0];if(!s)return new g(new Float32Array(0),[0],"float32");let a=s.shape[0]??3,r=s.shape[1]??this.options.height,i=s.shape[2]??this.options.width,c=new Float32Array(n*a*r*i);for(let l=0;l<e.length;l++){let u=e[l];u&&c.set(u.toFloat32Array(),l*a*r*i)}return new g(c,[n,a,r,i],"float32")}async loadFromUrl(t){return new Promise((e,n)=>{let s=new Image;s.crossOrigin="anonymous",s.onload=()=>{e(this.toImageData(s))},s.onerror=()=>{n(new Error(`Failed to load image from ${t}`))},s.src=t})}async loadFromBlob(t){let e=URL.createObjectURL(t);try{return await this.loadFromUrl(e)}finally{URL.revokeObjectURL(e)}}centerCrop(t){let e=this.options.cropSize,n,s;typeof e=="number"?(n=e,s=e):(n=e.width,s=e.height);let a=Math.max(0,Math.floor((t.width-n)/2)),r=Math.max(0,Math.floor((t.height-s)/2));this.ensureCanvas();let i=document.createElement("canvas");return i.width=t.width,i.height=t.height,i.getContext("2d").putImageData(t,0,0),this.canvas.width=n,this.canvas.height=s,this.ctx.drawImage(i,a,r,n,s,0,0,n,s),this.ctx.getImageData(0,0,n,s)}toImageData(t){this.ensureCanvas();let{width:e,height:n}=t;return this.canvas.width=e,this.canvas.height=n,this.ctx.drawImage(t,0,0),this.ctx.getImageData(0,0,e,n)}resize(t){let{width:e,height:n,resizeMode:s}=this.options;this.ensureCanvas();let a=0,r=0,i=t.width,c=t.height,l=0,u=0,d=e,h=n;if(s==="contain"){let w=Math.min(e/t.width,n/t.height);d=Math.round(t.width*w),h=Math.round(t.height*w),l=Math.round((e-d)/2),u=Math.round((n-h)/2)}else if(s==="cover"){let w=Math.max(e/t.width,n/t.height);i=Math.round(e/w),c=Math.round(n/w),a=Math.round((t.width-i)/2),r=Math.round((t.height-c)/2)}let p=document.createElement("canvas");return p.width=t.width,p.height=t.height,p.getContext("2d").putImageData(t,0,0),this.canvas.width=e,this.canvas.height=n,(s==="contain"||s==="pad")&&(this.ctx.fillStyle="black",this.ctx.fillRect(0,0,e,n)),this.ctx.drawImage(p,a,r,i,c,l,u,d,h),this.ctx.getImageData(0,0,e,n)}toTensor(t){let{mean:e,std:n,grayscale:s,channelFormat:a,dtype:r,doRescale:i,rescaleFactor:c,doNormalize:l}=this.options,u=t.height,d=t.width,h=s?1:3,p=new Float32Array(h*u*d),m=t.data;for(let y=0;y<u;y++)for(let k=0;k<d;k++){let M=(y*d+k)*4;if(s){let b=.299*(m[M]??0)+.587*(m[M+1]??0)+.114*(m[M+2]??0);i&&(b*=c),l&&(b=(b-(e[0]??0))/(n[0]??1));let S=y*d+k;p[S]=b}else if(a==="CHW")for(let b=0;b<3;b++){let S=m[M+b]??0;i&&(S*=c),l&&(S=(S-(e[b]??0))/(n[b]??1));let I=b*u*d+y*d+k;p[I]=S}else for(let b=0;b<3;b++){let S=m[M+b]??0;i&&(S*=c),l&&(S=(S-(e[b]??0))/(n[b]??1));let I=y*d*3+k*3+b;p[I]=S}}let w=a==="CHW"?[h,u,d]:[u,d,h];return new g(p,w,r)}getOptions(){return{...this.options}}},As={sampleRate:16e3,nMels:80,nFft:400,hopLength:160,normalize:!0,maxDuration:30},re=class o{constructor(t={}){f(this,"options");f(this,"audioContext",null);this.options={...As,...t}}static fromConfig(t){let e={},n=t.sampling_rate;typeof n=="number"&&(e.sampleRate=n);let s=t.feature_size;typeof s=="number"&&(e.nMels=s);let a=t.n_fft;typeof a=="number"&&(e.nFft=a);let r=t.hop_length;return typeof r=="number"&&(e.hopLength=r),new o(e)}static async fromHuggingFace(t,e){let n=e?.revision??"main",s=`https://huggingface.co/${t}/resolve/${n}/preprocessor_config.json`,a=await fetch(s);if(!a.ok)throw new Error(`Failed to load audio config from ${s}`);let r=await a.json();return o.fromConfig(r)}ensureAudioContext(){if(!this.audioContext)if(typeof AudioContext<"u")this.audioContext=new AudioContext({sampleRate:this.options.sampleRate});else throw new Error("AudioPreprocessor requires Web Audio API support")}async process(t){let e;typeof t=="string"?e=await this.loadFromUrl(t):t instanceof Blob||t instanceof File?e=await this.loadFromBlob(t):t instanceof AudioBuffer?e=this.audioBufferToFloat32(t):t instanceof Float32Array?e=t:e=await this.decodeAudioData(t),this.options.normalize&&(e=this.normalizeAudio(e));let n=this.options.maxDuration*this.options.sampleRate;return e.length>n&&(e=e.slice(0,n)),this.computeMelSpectrogram(e)}async processRaw(t){let e;typeof t=="string"?e=await this.loadFromUrl(t):t instanceof Blob||t instanceof File?e=await this.loadFromBlob(t):t instanceof AudioBuffer?e=this.audioBufferToFloat32(t):t instanceof Float32Array?e=t:e=await this.decodeAudioData(t),this.options.normalize&&(e=this.normalizeAudio(e));let n=this.options.maxDuration*this.options.sampleRate;return e.length>n&&(e=e.slice(0,n)),new g(e,[1,e.length],"float32")}async loadFromUrl(t){let e=await fetch(t);if(!e.ok)throw new Error(`Failed to load audio from ${t}`);let n=await e.arrayBuffer();return this.decodeAudioData(n)}async loadFromBlob(t){let e=await t.arrayBuffer();return this.decodeAudioData(e)}async decodeAudioData(t){this.ensureAudioContext();let e=await this.audioContext.decodeAudioData(t.slice(0));return this.audioBufferToFloat32(e)}audioBufferToFloat32(t){let e=t.getChannelData(0);return new Float32Array(e)}normalizeAudio(t){let e=0;for(let n=0;n<t.length;n++){let s=Math.abs(t[n]??0);s>e&&(e=s)}if(e>0){let n=new Float32Array(t.length);for(let s=0;s<t.length;s++)n[s]=(t[s]??0)/e;return n}return t}computeMelSpectrogram(t){let{nMels:e,nFft:n,hopLength:s}=this.options,a=Math.floor((t.length-n)/s)+1;if(a<=0)return new g(new Float32Array(e),[1,e],"float32");let r=new Float32Array(a*e);for(let i=0;i<a;i++){let c=i*s;for(let l=0;l<e;l++){let u=0,d=Math.floor(l/e*(n/2)),h=Math.floor((l+1)/e*(n/2));for(let p=d;p<Math.min(h,n);p++){let m=t[c+p]??0;u+=m*m}r[i*e+l]=Math.log(u+1e-10)}}return new g(r,[a,e],"float32")}dispose(){this.audioContext&&(this.audioContext.close(),this.audioContext=null)}};function yn(o,t={}){let{lowercase:e=!0,removePunctuation:n=!1,normalizeWhitespace:s=!0,maxLength:a}=t,r=o;return e&&(r=r.toLowerCase()),n&&(r=r.replace(/[^\w\s]/g,"")),s&&(r=r.replace(/\s+/g," ").trim()),a&&r.length>a&&(r=r.slice(0,a)),r}function Be(o="imagenet",t={}){let e={imagenet:{width:224,height:224,mean:[.485,.456,.406],std:[.229,.224,.225]},clip:{width:224,height:224,mean:[.48145466,.4578275,.40821073],std:[.26862954,.26130258,.27577711]},vit:{width:224,height:224,mean:[.5,.5,.5],std:[.5,.5,.5]},custom:{}};return new se({...e[o],...t})}function wn(o="whisper",t={}){let e={whisper:{sampleRate:16e3,nMels:80,nFft:400,hopLength:160},wav2vec:{sampleRate:16e3,normalize:!0},custom:{}};return new re({...e[o],...t})}var K=class extends z{constructor(e,n,s=1e3){super(e);f(this,"preprocessor",null);f(this,"labels");f(this,"numClasses");this.labels=n??Oe,this.numClasses=s}async initialize(){await super.initialize(),this.preprocessor||(this.preprocessor=Be("imagenet"))}setLabels(e){this.labels=e,this.numClasses=e.length}async run(e,n){let s=Array.isArray(e),a=s?e:[e];await this.initialize();let r=performance.now(),i=[];for(let l of a){let u=await this.preprocess(l),d=await this.runInference(u),h=await this.postprocess(d,n);i.push(h)}let c=performance.now()-r;for(let l of i)l.processingTime=c/i.length;return s?i:i[0]}async preprocess(e){let n=Array.isArray(e)?e[0]:e,s=await this.preprocessor.process(n);return s.shape.length===3?[s.reshape([1,...s.shape])]:[s]}async runInference(e){let n=new Float32Array(this.numClasses),s=e[0]?.toFloat32Array()??new Float32Array(0),a=0;for(let r=0;r<Math.min(1e3,s.length);r++)a+=s[r]??0;for(let r=0;r<this.numClasses;r++)n[r]=Math.sin(a*(r+1)*.1)*3;return[new g(n,[1,this.numClasses],"float32")]}async postprocess(e,n){let s=e[0];if(!s)return{label:"unknown",score:0};let r=D(s,-1).toFloat32Array();(n?.topK??1)>1||n?.returnAllScores;let c=0,l=r[0]??0;for(let d=1;d<r.length;d++)(r[d]??0)>l&&(l=r[d]??0,c=d);return{label:n?.labels?.[c]??this.labels[c]??`class_${c}`,score:l}}};function xn(o={},t){return new K({task:"image-classification",model:o.model??"default",runtime:o.runtime,cache:o.cache??!0,quantization:o.quantization},t)}j("image-classification",o=>new K(o));E();var Ue=class extends z{constructor(e){super(e??{task:"text-generation",model:"default"});f(this,"tokenizer",null);f(this,"eosTokenId",50256)}setTokenizer(e){this.tokenizer=e;let n=e.getSpecialTokenIds();this.eosTokenId=n.eosTokenId??n.sepTokenId??50256}async preprocess(e){let n=Array.isArray(e)?e[0]??"":e;if(!this.tokenizer)return[new g(new Float32Array([0]),[1],"float32")];let s=this.tokenizer.encode(n,{addSpecialTokens:!1,padding:"do_not_pad"});return[new g(BigInt64Array.from(s.inputIds.map(a=>BigInt(a))),[1,s.inputIds.length],"int64")]}async postprocess(e,n){return{generatedText:"",tokenIds:[],numTokens:0,processingTime:0}}async run(e,n){await this.initialize();let s=Array.isArray(e)?e:[e],a=await Promise.all(s.map(r=>this.generateSingle(r,n??{})));return Array.isArray(e)?a:a[0]}async*stream(e,n={}){let s=performance.now();if(!this.tokenizer)throw new Error("Tokenizer not set. Call setTokenizer() first.");let{maxNewTokens:a=50,maxLength:r=512,temperature:i=1,topK:c=0,topP:l=1,repetitionPenalty:u=1,stopSequences:d=[],doSample:h=!0}=n,m=[...this.tokenizer.encode(e,{addSpecialTokens:!1,padding:"do_not_pad",truncation:!1}).inputIds],w=[],y="";for(let M=0;M<a&&!(m.length>=r);M++){let b=await this.generateNextToken(m,i,c,l,u,h);if(b===this.eosTokenId){yield{token:"",tokenId:b,generatedText:y,done:!0};break}let S=this.tokenizer.decode([b],!0);w.push(b),m.push(b),y+=S,n.onToken&&n.onToken(S,b);let I=!1;for(let _ of d)if(y.endsWith(_)){y=y.slice(0,-_.length),I=!0;break}if(yield{token:S,tokenId:b,generatedText:y,done:I},I)break}let k=performance.now();console.log(`Generation completed in ${(k-s).toFixed(2)}ms`)}async generateSingle(e,n){let s=performance.now();if(!this.tokenizer)throw new Error("Tokenizer not set. Call setTokenizer() first.");let{maxNewTokens:a=50,maxLength:r=512,temperature:i=1,topK:c=0,topP:l=1,repetitionPenalty:u=1,stopSequences:d=[],doSample:h=!0,returnFullText:p=!1}=n,w=[...this.tokenizer.encode(e,{addSpecialTokens:!1,padding:"do_not_pad",truncation:!1}).inputIds],y=[];for(let b=0;b<a&&!(w.length>=r);b++){let S=await this.generateNextToken(w,i,c,l,u,h);if(S===this.eosTokenId)break;if(y.push(S),w.push(S),n.onToken){let F=this.tokenizer.decode([S],!0);n.onToken(F,S)}let I=this.tokenizer.decode(y,!0),_=!1;for(let F of d)if(I.endsWith(F)){_=!0;break}if(_)break}let k=this.tokenizer.decode(y,!0),M=performance.now();return{generatedText:k,fullText:p?e+k:void 0,tokenIds:y,numTokens:y.length,processingTime:M-s}}async generateNextToken(e,n,s,a,r,i){if(!this.model)throw new Error("Model not loaded");let c=new g(BigInt64Array.from(e.map(M=>BigInt(M))),[1,e.length],"int64"),l=new g(BigInt64Array.from(e.map(()=>BigInt(1))),[1,e.length],"int64"),u=await ge(this.model,[c,l]);if(!u||u.length===0)throw new Error("Model returned no outputs");let d=u[0],h=d.toFloat32Array(),p=d.shape[d.shape.length-1]??50257,m=new Float32Array(p),w=(e.length-1)*p;for(let M=0;M<p;M++)m[M]=h[w+M]??0;if(r!==1){for(let M of e)if(M<p){let b=m[M]??0;m[M]=b>0?b/r:b*r}}if(n!==1)for(let M=0;M<p;M++)m[M]=(m[M]??0)/n;let y=new g(m,[p],"float32"),k=D(y).toFloat32Array();return i?this.sample(k,s,a):this.greedy(k)}greedy(e){let n=0,s=e[0]??0;for(let a=1;a<e.length;a++)(e[a]??0)>s&&(s=e[a]??0,n=a);return n}sample(e,n,s){let a=Array.from({length:e.length},(u,d)=>d);a.sort((u,d)=>(e[d]??0)-(e[u]??0));let r=a;if(n>0&&n<e.length&&(r=a.slice(0,n)),s<1){let u=0,d=[];for(let h of r)if(d.push(h),u+=e[h]??0,u>=s)break;r=d}let i=0;for(let u of r)i+=e[u]??0;let c=Math.random()*i,l=0;for(let u of r)if(l+=e[u]??0,l>=c)return u;return r[0]??0}};E();var Ss=["person","bicycle","car","motorcycle","airplane","bus","train","truck","boat","traffic light","fire hydrant","stop sign","parking meter","bench","bird","cat","dog","horse","sheep","cow","elephant","bear","zebra","giraffe","backpack","umbrella","handbag","tie","suitcase","frisbee","skis","snowboard","sports ball","kite","baseball bat","baseball glove","skateboard","surfboard","tennis racket","bottle","wine glass","cup","fork","knife","spoon","bowl","banana","apple","sandwich","orange","broccoli","carrot","hot dog","pizza","donut","cake","chair","couch","potted plant","bed","dining table","toilet","tv","laptop","mouse","remote","keyboard","cell phone","microwave","oven","toaster","sink","refrigerator","book","clock","vase","scissors","teddy bear","hair drier","toothbrush"],qe=class extends z{constructor(e,n){super(e??{task:"object-detection",model:"default"});f(this,"preprocessor");f(this,"labels");this.labels=n??Ss,this.preprocessor=new se({width:640,height:640,mean:[.485,.456,.406],std:[.229,.224,.225],channelFormat:"CHW"})}setLabels(e){this.labels=e}async preprocess(e){let n=Array.isArray(e)?e:[e];if(n.length===1){let s=await this.preprocessor.process(n[0]);return[new g(s.toFloat32Array(),[1,...s.shape],"float32")]}return[await this.preprocessor.processBatch(n)]}async postprocess(e,n){let s=n??{},a=s.threshold??.5,r=s.topK??100,i=s.nms??!0,c=s.iouThreshold??.5;if(!e[0])return[];let l=e[0].toFloat32Array(),u=[...e[0].shape],d=this.parseDetections(l,u,a),h=i?this.nonMaxSuppression(d,c):d;return h.sort((p,m)=>m.score-p.score),h=h.slice(0,r),h}parseDetections(e,n,s){let a=[],r=n[1]??0,i=n[2]??0;if(i>=5){let c=i-5;for(let l=0;l<r;l++){let u=l*i,d=e[u+4]??0;if(d<s)continue;let h=0,p=0;for(let b=0;b<c;b++){let S=e[u+5+b]??0;S>h&&(h=S,p=b)}let m=d*h;if(m<s)continue;let w=e[u]??0,y=e[u+1]??0,k=e[u+2]??0,M=e[u+3]??0;a.push({label:this.labels[p]??`class_${p}`,score:m,classId:p,box:{x:Math.max(0,w-k/2),y:Math.max(0,y-M/2),width:k,height:M},boxNormalized:{x:Math.max(0,w-k/2),y:Math.max(0,y-M/2),width:k,height:M}})}}else if(i===4)for(let c=0;c<r;c++){let l=c*i,u=e[l]??0,d=e[l+1]??0,h=e[l+2]??0,p=e[l+3]??0;a.push({label:this.labels[0]??"object",score:1,classId:0,box:{x:u,y:d,width:h-u,height:p-d},boxNormalized:{x:u,y:d,width:h-u,height:p-d}})}return a}nonMaxSuppression(e,n){if(e.length===0)return[];let s=[...e].sort((i,c)=>c.score-i.score),a=[],r=new Array(s.length).fill(!0);for(let i=0;i<s.length;i++){if(!r[i])continue;let c=s[i];a.push(c);for(let l=i+1;l<s.length;l++){if(!r[l])continue;let u=s[l];if(c.classId!==u.classId)continue;this.computeIoU(c.box,u.box)>n&&(r[l]=!1)}}return a}computeIoU(e,n){let s=Math.max(0,Math.min(e.x+e.width,n.x+n.width)-Math.max(e.x,n.x)),a=Math.max(0,Math.min(e.y+e.height,n.y+n.height)-Math.max(e.y,n.y)),r=s*a,i=e.width*e.height,c=n.width*n.height,l=i+c-r;return l>0?r/l:0}};E();var je=class extends z{constructor(e){super(e??{task:"automatic-speech-recognition",model:"default"});f(this,"audioPreprocessor");f(this,"tokenizer",null);this.audioPreprocessor=new re({sampleRate:16e3,nMels:80,nFft:400,hopLength:160,maxDuration:30})}setTokenizer(e){this.tokenizer=e}async preprocess(e){let n=Array.isArray(e)?e:[e],s=await Promise.all(n.map(a=>this.audioPreprocessor.process(a)));if(s.length===1){let a=s[0];return[new g(a.toFloat32Array(),[1,...a.shape],"float32")]}return s}async postprocess(e,n){let a=(n??{}).returnTimestamps??!1;if(!e[0])return{text:""};let r=e[0].toFloat32Array(),i=e[0].shape,c=this.decodeOutput(r,i),l={text:c};return a&&(l.chunks=this.extractTimestamps(r,i,c)),l}decodeOutput(e,n){let s=n[1]??e.length,a=n[2]??1,r=[];if(a>1)for(let i=0;i<s;i++){let c=i*a,l=0,u=e[c]??-1/0;for(let d=1;d<a;d++)(e[c+d]??-1/0)>u&&(u=e[c+d]??-1/0,l=d);r.push(l)}else for(let i=0;i<e.length;i++)r.push(Math.round(e[i]??0));return this.tokenizer?this.tokenizer.decode(r,!0):r.join(" ")}extractTimestamps(e,n,s){let a=s.split(/\s+/).filter(u=>u.length>0),r=[],i=2.5,c="",l=0;for(let u=0;u<a.length;u++)if(c+=(c?" ":"")+a[u],(u+1)%5===0||u===a.length-1){let d=c.split(/\s+/).length/i;r.push({text:c,start:l,end:l+d}),l=l+d,c=""}return r}async processLongAudio(e,n={}){let s=n.chunkDuration??30,a=n.chunkOverlap??5,i=(await this.audioPreprocessor.processRaw(e)).toFloat32Array(),c=16e3,l=s*c,u=a*c,d=l-u,h=[];for(let w=0;w<i.length;w+=d){let y=Math.min(w+l,i.length),k=i.slice(w,y),M=await this.run(new Float32Array(k),n);if(M.chunks){let b=w/c;M.chunks=M.chunks.map(S=>({...S,start:S.start+b,end:S.end+b}))}h.push(M)}let p=h.map(w=>w.text).join(" "),m=h.flatMap(w=>w.chunks??[]);return{text:p,chunks:m}}};E();var He=class extends z{constructor(e){super(e??{task:"zero-shot-classification",model:"default"});f(this,"tokenizer",null);f(this,"hypothesisTemplate","This text is about {label}.")}setTokenizer(e){this.tokenizer=e}async classify(e,n,s){return this.run({text:e,candidateLabels:n},s)}async run(e,n){await this.initialize();let{text:s,candidateLabels:a}=e,r=n??{},i=Array.isArray(s)?s:[s],c=r.hypothesisTemplate??this.hypothesisTemplate,l=r.multiLabel??!1,u=await Promise.all(i.map(d=>this.classifySingle(d,a,c,l)));return Array.isArray(s)?u:u[0]}async classifySingle(e,n,s,a){let r=performance.now(),i=n.map(d=>s.replace("{label}",d)),c=[];for(let d of i){let h=await this.scoreHypothesis(e,d);c.push(h)}let l;if(a)l=c.map(d=>1/(1+Math.exp(-d)));else{let d=new g(new Float32Array(c),[c.length],"float32");l=Array.from(D(d).toFloat32Array())}let u=n.map((d,h)=>({label:d,score:l[h]??0}));return u.sort((d,h)=>h.score-d.score),{sequence:e,labels:u.map(d=>d.label),scores:u.map(d=>d.score),processingTime:performance.now()-r}}async scoreHypothesis(e,n){if(!this.tokenizer)throw new Error("Tokenizer not set. Call setTokenizer() first.");return this.tokenizer.encode(e,{textPair:n,addSpecialTokens:!0,maxLength:512,truncation:!0,returnAttentionMask:!0,returnTokenTypeIds:!0}),Math.random()}async preprocess(e){let{text:n,candidateLabels:s}=e,a=Array.isArray(n)?n[0]??"":n,r=s[0]??"";if(!this.tokenizer)return[new g(new Float32Array([0]),[1],"float32")];let i=this.tokenizer.encode(a,{textPair:this.hypothesisTemplate.replace("{label}",r),addSpecialTokens:!0,maxLength:512});return[new g(BigInt64Array.from(i.inputIds.map(c=>BigInt(c))),[1,i.inputIds.length],"int64")]}async postprocess(e,n){return{sequence:"",labels:[],scores:[]}}};E();var We=class extends z{constructor(e){super(e??{task:"question-answering",model:"default"});f(this,"tokenizer",null)}setTokenizer(e){this.tokenizer=e}async run(e,n){await this.initialize();let s=Array.isArray(e)?e:[e],a=await Promise.all(s.map(r=>this.answerQuestion(r,n??{})));return Array.isArray(e)?a:a[0]}async answerQuestion(e,n){let s=performance.now();if(!this.tokenizer)throw new Error("Tokenizer not set. Call setTokenizer() first.");let{question:a,context:r}=e,{maxAnswerLength:i=30}=n,c=this.tokenizer.encode(a,{textPair:r,addSpecialTokens:!0,maxLength:512,truncation:!0,returnAttentionMask:!0,returnTokenTypeIds:!0}),l=this.findBestAnswer(r,a,c.inputIds,i);return{answer:l.text,score:l.score,start:l.start,end:l.end,processingTime:performance.now()-s}}findBestAnswer(e,n,s,a){let r=n.toLowerCase().split(/\s+/),i=e.split(/[.!?]+/).filter(p=>p.trim()),c="",l=0,u=0;for(let p of i){let m=p.toLowerCase().split(/\s+/),w=0;for(let y of r)m.some(k=>k.includes(y)||y.includes(k))&&(w+=1);w>l&&(l=w,c=p.trim(),u=e.indexOf(p.trim()))}let d=c.split(/\s+/);d.length>a&&(c=d.slice(0,a).join(" "));let h=r.length>0?l/r.length:0;return{text:c||"No answer found",score:Math.min(h,1),start:u>=0?u:0,end:u>=0?u+c.length:0}}async preprocess(e){if(!this.tokenizer)return[new g(new Float32Array([0]),[1],"float32")];let n=Array.isArray(e)?e[0]:e,s=this.tokenizer.encode(n.question,{textPair:n.context,addSpecialTokens:!0,maxLength:512,truncation:!0,returnAttentionMask:!0,returnTokenTypeIds:!0});return[new g(BigInt64Array.from(s.inputIds.map(a=>BigInt(a))),[1,s.inputIds.length],"int64"),new g(BigInt64Array.from(s.attentionMask.map(a=>BigInt(a))),[1,s.attentionMask.length],"int64")]}async postprocess(e,n){if(e.length<2)return{answer:"",score:0,start:0,end:0};let s=e[0].toFloat32Array(),a=e[1].toFloat32Array(),r=s.length,i=D(new g(s,[r],"float32")).toFloat32Array(),c=D(new g(a,[r],"float32")).toFloat32Array(),l=0,u=0,d=0;for(let h=0;h<r;h++)for(let p=h;p<Math.min(h+30,r);p++){let m=(i[h]??0)*(c[p]??0);m>d&&(d=m,l=h,u=p)}return{answer:"",score:d,start:l,end:u}}};async function Tn(o,t){let e={task:o,model:t?.model??"default",runtime:t?.runtime,cache:t?.cache??!0,quantization:t?.quantization},n;switch(o){case"text-classification":n=new W(e,t?.labels);break;case"sentiment-analysis":n=new X(e);break;case"feature-extraction":n=new Q(e);break;case"image-classification":n=new K(e,t?.labels);break;case"text-generation":n=new Ue(e);break;case"object-detection":n=new qe(e,t?.labels);break;case"automatic-speech-recognition":n=new je(e);break;case"zero-shot-classification":n=new He(e);break;case"question-answering":n=new We(e);break;default:throw new Error(`Unknown pipeline task: ${o}`)}return await n.initialize(),n}async function Is(o,t){let e=await Promise.all(o.map(s=>Tn(s,t))),n={};for(let s=0;s<o.length;s++){let a=o[s];n[a]=e[s]}return n}Le();Le();C();var zs="https://huggingface.co",vs="main",bn=["model.onnx","model_quantized.onnx","model_int8.onnx","model_uint8.onnx","model_fp16.onnx","onnx/model.onnx","onnx/model_quantized.onnx"];function Ve(o,t,e={}){let n=e.endpoint??zs,s=e.revision??vs,a=e.subfolder?`${e.subfolder}/`:"";return`${n}/${o}/resolve/${s}/${a}${t}`}async function Mn(o,t){let e={};return t&&(e.Authorization=`Bearer ${t}`),await fetch(o,{headers:e})}async function kn(o,t,e={}){let n=Ve(o,t,e);try{let s=await Mn(n,e.token);return s.ok||s.status===302}catch{return!1}}async function Tt(o,t={}){for(let e of bn)if(await kn(o,e,t))return e;return null}async function An(o,t,e={}){let n=Ve(o,t,e);return te(n,{cache:e.cache??!0,forceDownload:e.forceDownload??!1,onProgress:e.onProgress?s=>{e.onProgress({file:t,fileIndex:1,totalFiles:1,fileProgress:s,overallProgress:s.percent})}:void 0})}async function Es(o,t,e={}){let n=Ve(o,t,e);if(e.cache!==!1&&!e.forceDownload&&await me(n)){let r=await te(n,{cache:!0}),i=new TextDecoder().decode(r);return JSON.parse(i)}let s=await Mn(n,e.token);if(!s.ok)throw new x(`Failed to download ${t} from ${o}: ${s.status}`,T.MODEL_NOT_FOUND);return s.json()}async function bt(o,t={}){let e=Ve(o,"tokenizer.json",t);return H.fromUrl(e)}async function Ge(o,t={}){return Es(o,"config.json",t)}async function Xe(o,t={}){let e={},s=0,a=(u,d)=>{if(t.onProgress){let h=s/3*100,p=d.percent/3;t.onProgress({file:u,fileIndex:s+1,totalFiles:3,fileProgress:d,overallProgress:h+p})}};console.log(`\u{1F50D} Finding ONNX model in ${o}...`);let r=await Tt(o,t);if(!r)throw new x(`No ONNX model found in ${o}. Please ensure the model has an ONNX file.`,T.MODEL_NOT_FOUND,{modelId:o,triedFiles:bn});e.model=r,console.log(`\u{1F4E6} Downloading model: ${r}`);let i=await An(o,r,{...t,onProgress:u=>a(r,u.fileProgress)});s=1;let c;try{console.log("\u{1F4DD} Downloading tokenizer..."),e.tokenizer="tokenizer.json",c=await bt(o,t),console.log("\u2713 Tokenizer loaded")}catch{console.warn(`\u26A0\uFE0F No tokenizer found for ${o}`)}s=2;let l;try{console.log("\u2699\uFE0F Downloading config..."),e.config="config.json",l=await Ge(o,t),console.log("\u2713 Config loaded")}catch{console.warn(`\u26A0\uFE0F No config found for ${o}`)}return s=3,t.onProgress&&t.onProgress({file:"complete",fileIndex:3,totalFiles:3,fileProgress:{loaded:1,total:1,percent:100,speed:0,eta:0},overallProgress:100}),console.log(`\u2705 Model bundle downloaded: ${o}`),{modelId:o,modelData:i,tokenizer:c,config:l,files:e}}async function Sn(o,t={}){return Xe(o,t)}async function In(o,t={}){try{return await Tt(o,t)!==null}catch{return!1}}async function zn(o,t={}){let[e,n,s]=await Promise.all([Tt(o,t),kn(o,"tokenizer.json",t),Ge(o,t).catch(()=>{})]);return{hasOnnx:e!==null,onnxFile:e??void 0,hasTokenizer:n,hasConfig:s!==void 0,config:s}}var Mt={"sentiment-analysis":"Xenova/distilbert-base-uncased-finetuned-sst-2-english","text-classification":"Xenova/distilbert-base-uncased-finetuned-sst-2-english","feature-extraction":"Xenova/all-MiniLM-L6-v2","sentence-similarity":"Xenova/all-MiniLM-L6-v2","question-answering":"Xenova/distilbert-base-cased-distilled-squad",ner:"Xenova/bert-base-NER","token-classification":"Xenova/bert-base-NER","text-generation":"Xenova/gpt2","translation-en-fr":"Xenova/t5-small","translation-en-de":"Xenova/t5-small",summarization:"Xenova/distilbart-cnn-6-6","fill-mask":"Xenova/bert-base-uncased","image-classification":"Xenova/vit-base-patch16-224","object-detection":"Xenova/detr-resnet-50","image-segmentation":"Xenova/segformer-b0-finetuned-ade-512-512","zero-shot-classification":"Xenova/mobilebert-uncased-mnli","automatic-speech-recognition":"Xenova/whisper-tiny.en","text-to-speech":"Xenova/speecht5_tts"};function kt(o){return Mt[o]}async function vn(o,t={}){let e=kt(o);return Xe(e,t)}async function Ae(o,t={}){let{warmupRuns:e=3,runs:n=10,verbose:s=!1,timeout:a=3e4,name:r="benchmark"}=t,i=[],c=0;s&&console.log(`[${r}] Running ${e} warmup iterations...`);for(let w=0;w<e;w++)try{await Promise.race([Promise.resolve(o()),new Promise((y,k)=>setTimeout(()=>k(new Error("Timeout")),a))])}catch{}s&&console.log(`[${r}] Running ${n} measured iterations...`);for(let w=0;w<n;w++)try{let y=performance.now();await Promise.race([Promise.resolve(o()),new Promise((M,b)=>setTimeout(()=>b(new Error("Timeout")),a))]);let k=performance.now();i.push(k-y),s&&console.log(`  Run ${w+1}: ${(k-y).toFixed(2)}ms`)}catch(y){c++,s&&console.log(`  Run ${w+1}: FAILED - ${y}`)}if(i.length===0)throw new Error(`All ${n} runs failed`);let l=[...i].sort((w,y)=>w-y),d=i.reduce((w,y)=>w+y,0)/i.length,h=i.reduce((w,y)=>w+Math.pow(y-d,2),0)/i.length,p=Math.sqrt(h),m={name:r,avgTime:d,medianTime:l[Math.floor(l.length/2)]??0,minTime:l[0]??0,maxTime:l[l.length-1]??0,stdDev:p,p95:l[Math.floor(l.length*.95)]??l[l.length-1]??0,p99:l[Math.floor(l.length*.99)]??l[l.length-1]??0,throughput:1e3/d,times:i,totalRuns:n,failedRuns:c};return s&&(console.log(`
[${r}] Results:`),console.log(`  Avg: ${m.avgTime.toFixed(2)}ms`),console.log(`  Median: ${m.medianTime.toFixed(2)}ms`),console.log(`  Min: ${m.minTime.toFixed(2)}ms`),console.log(`  Max: ${m.maxTime.toFixed(2)}ms`),console.log(`  Std Dev: ${m.stdDev.toFixed(2)}ms`),console.log(`  P95: ${m.p95.toFixed(2)}ms`),console.log(`  Throughput: ${m.throughput.toFixed(2)} ops/sec`)),m}async function En(o,t,e={}){let n=await Ae(o,{...e,name:e.name?`${e.name} (baseline)`:"baseline"}),s=await Ae(t,{...e,name:e.name?`${e.name} (comparison)`:"comparison"}),a=n.avgTime/s.avgTime,r=(n.avgTime-s.avgTime)/n.avgTime*100,i;return Math.abs(r)<5?i="tie":r>0?i="comparison":i="baseline",{baseline:n,comparison:s,speedup:a,percentFaster:r,winner:i}}async function Fn(o,t={}){let e={};for(let[n,s]of Object.entries(o))console.log(`
=== ${n} ===`),e[n]=await Ae(s,{...t,name:n,verbose:!0});return e}function Dn(o){return`
\u250C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510
\u2502 ${o.name.padEnd(39)} \u2502
\u251C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524
\u2502 Avg Time:    ${o.avgTime.toFixed(2).padStart(10)}ms             \u2502
\u2502 Median:      ${o.medianTime.toFixed(2).padStart(10)}ms             \u2502
\u2502 Min Time:    ${o.minTime.toFixed(2).padStart(10)}ms             \u2502
\u2502 Max Time:    ${o.maxTime.toFixed(2).padStart(10)}ms             \u2502
\u2502 Std Dev:     ${o.stdDev.toFixed(2).padStart(10)}ms             \u2502
\u2502 P95:         ${o.p95.toFixed(2).padStart(10)}ms             \u2502
\u2502 P99:         ${o.p99.toFixed(2).padStart(10)}ms             \u2502
\u2502 Throughput:  ${o.throughput.toFixed(2).padStart(10)} ops/sec     \u2502
\u2502 Runs:        ${o.totalRuns.toString().padStart(10)} (${o.failedRuns} failed)  \u2502
\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518
  `.trim()}function Pn(o){let t=o.percentFaster>0?"\u2191":o.percentFaster<0?"\u2193":"=",e=o.winner==="comparison"?"Comparison is faster!":o.winner==="baseline"?"Baseline is faster!":"Results are similar";return`
\u250C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510
\u2502                  BENCHMARK COMPARISON               \u2502
\u251C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524
\u2502 Baseline:    ${o.baseline.avgTime.toFixed(2).padStart(10)}ms                       \u2502
\u2502 Comparison:  ${o.comparison.avgTime.toFixed(2).padStart(10)}ms                       \u2502
\u251C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524
\u2502 Speedup:     ${o.speedup.toFixed(2).padStart(10)}x                        \u2502
\u2502 Difference:  ${t} ${Math.abs(o.percentFaster).toFixed(1).padStart(8)}%                      \u2502
\u251C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524
\u2502 Winner: ${e.padEnd(42)} \u2502
\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518
  `.trim()}async function _n(o,t={}){let{name:e="memory-benchmark",runs:n=5}=t,s=()=>typeof performance<"u"&&"memory"in performance?performance.memory.usedJSHeapSize:0,a=[],r=s();for(let u=0;u<n;u++)await o(),a.push(s());let i=Math.max(...a),c=a.reduce((u,d)=>u+d,0)/a.length,l=c-r;return{name:e,peakMemory:i,avgMemory:c,memoryDelta:l}}C();E();function Ln(o,t,e,n,s=0,a=[]){let r=e?-(1<<t-1):0,i=e?(1<<t-1)-1:(1<<t)-1;if(n&&a.length>1){let c=a[s]??1,l=new Float32Array(c),u=new Int32Array(c),d=o.length/c,h=1/0,p=-1/0;for(let m=0;m<c;m++){let w=1/0,y=-1/0;for(let k=0;k<d;k++){let M=m*d+k,b=o[M]??0;w=Math.min(w,b),y=Math.max(y,b)}if(h=Math.min(h,w),p=Math.max(p,y),e){let k=Math.max(Math.abs(w),Math.abs(y));l[m]=k/i,u[m]=0}else l[m]=(y-w)/(i-r),u[m]=Math.round(r-w/(l[m]||1));l[m]===0&&(l[m]=1)}return{scale:l,zeroPoint:u,min:h,max:p}}else{let c=1/0,l=-1/0;for(let h=0;h<o.length;h++){let p=o[h]??0;c=Math.min(c,p),l=Math.max(l,p)}let u,d;return e?(u=Math.max(Math.abs(c),Math.abs(l))/i,d=0):(u=(l-c)/(i-r),d=Math.round(r-c/(u||1))),u===0&&(u=1),{scale:u,zeroPoint:d,min:c,max:l}}}function Qe(o,t,e,n,s=o.length){let a=new Int8Array(o.length);if(n&&t instanceof Float32Array){let r=t.length;for(let i=0;i<r;i++){let c=t[i]??1,l=e[i]??0;for(let u=0;u<s;u++){let d=i*s+u,h=o[d]??0;a[d]=Math.max(-128,Math.min(127,Math.round(h/c+l)))}}}else{let r=t,i=e;for(let c=0;c<o.length;c++){let l=o[c]??0;a[c]=Math.max(-128,Math.min(127,Math.round(l/r+i)))}}return a}function Cn(o,t,e,n,s=o.length){let a=new Uint8Array(o.length);if(n&&t instanceof Float32Array){let r=t.length;for(let i=0;i<r;i++){let c=t[i]??1,l=e[i]??0;for(let u=0;u<s;u++){let d=i*s+u,h=o[d]??0;a[d]=Math.max(0,Math.min(255,Math.round(h/c+l)))}}}else{let r=t,i=e;for(let c=0;c<o.length;c++){let l=o[c]??0;a[c]=Math.max(0,Math.min(255,Math.round(l/r+i)))}}return a}function Fs(o,t,e){let n=Math.ceil(o.length/2),s=new Uint8Array(n);for(let a=0;a<o.length;a+=2){let r=o[a]??0,i=o[a+1]??0,c=Math.max(0,Math.min(15,Math.round(r/t+e+8))),l=Math.max(0,Math.min(15,Math.round(i/t+e+8)));s[a>>1]=c<<4|l}return s}function Nn(o){let t=new Uint16Array(o.length);for(let e=0;e<o.length;e++)t[e]=Ds(o[e]??0);return t}function Ds(o){let t=new Float32Array(1),e=new Int32Array(t.buffer);t[0]=o;let n=e[0],s=n>>16&32768,a=(n>>23&255)-127+15,r=n&8388607;if(a<=0){if(a<-10)return s;let i=(r|8388608)>>1-a;return s|i>>13}else if(a>=31)return s|31744;return s|a<<10|r>>13}function Ke(o,t,e,n=!1,s=o.length){let a=new Float32Array(o.length);if(n&&t instanceof Float32Array){let r=t.length;for(let i=0;i<r;i++){let c=t[i]??1,l=e[i]??0;for(let u=0;u<s;u++){let d=i*s+u;a[d]=((o[d]??0)-l)*c}}}else{let r=t,i=e;for(let c=0;c<o.length;c++)a[c]=((o[c]??0)-i)*r}return a}function At(o,t,e,n=!1,s=o.length){let a=new Float32Array(o.length);if(n&&t instanceof Float32Array){let r=t.length;for(let i=0;i<r;i++){let c=t[i]??1,l=e[i]??0;for(let u=0;u<s;u++){let d=i*s+u;a[d]=((o[d]??0)-l)*c}}}else{let r=t,i=e;for(let c=0;c<o.length;c++)a[c]=((o[c]??0)-i)*r}return a}function St(o){let t=(o&32768)>>15,e=(o&31744)>>10,n=o&1023;return e===0?n===0?t===0?0:-0:(t===0?1:-1)*Math.pow(2,-14)*(n/1024):e===31?n===0?t===0?1/0:-1/0:NaN:(t===0?1:-1)*Math.pow(2,e-15)*(1+n/1024)}function It(o){let t=new Float32Array(o.length);for(let e=0;e<o.length;e++)t[e]=St(o[e]??0);return t}function zt(o){let t=[],e=new Float32Array(o);return t.push({name:"model_weights",data:e,shape:[e.length],dtype:"float32"}),t}function Ps(o){let t=new TextEncoder,e=20;for(let i of o.weights){let c=t.encode(i.name),l=t.encode(i.dtype),u=t.encode(i.originalDtype);e+=4+c.length,e+=4+i.shape.length*4,e+=4+l.length,e+=4+u.length,e+=1,i.scale!==void 0&&(e+=Array.isArray(i.scale)?4+i.scale.length*4:4),e+=1,i.zeroPoint!==void 0&&(e+=Array.isArray(i.zeroPoint)?4+i.zeroPoint.length*4:4),e+=8+i.data.byteLength}let n=new ArrayBuffer(e),s=new DataView(n),a=new Uint8Array(n),r=0;s.setUint32(r,o.version,!0),r+=4,s.setUint32(r,["int8","uint8","int4","float16","dynamic"].indexOf(o.quantizationType),!0),r+=4,s.setUint32(r,o.originalSize&4294967295,!0),r+=4,s.setUint32(r,o.originalSize/4294967296>>>0,!0),r+=4,s.setUint32(r,o.weights.length,!0),r+=4;for(let i of o.weights){let c=t.encode(i.name),l=t.encode(i.dtype),u=t.encode(i.originalDtype);s.setUint32(r,c.length,!0),r+=4,a.set(c,r),r+=c.length,s.setUint32(r,i.shape.length,!0),r+=4;for(let p of i.shape)s.setInt32(r,p,!0),r+=4;if(s.setUint32(r,l.length,!0),r+=4,a.set(l,r),r+=l.length,s.setUint32(r,u.length,!0),r+=4,a.set(u,r),r+=u.length,i.scale!==void 0)if(s.setUint8(r,1),r+=1,Array.isArray(i.scale)){s.setUint32(r,i.scale.length,!0),r+=4;for(let p of i.scale)s.setFloat32(r,p,!0),r+=4}else s.setUint32(r,1,!0),r+=4,s.setFloat32(r,i.scale,!0),r+=4;else s.setUint8(r,0),r+=1;if(i.zeroPoint!==void 0)if(s.setUint8(r,1),r+=1,Array.isArray(i.zeroPoint)){s.setUint32(r,i.zeroPoint.length,!0),r+=4;for(let p of i.zeroPoint)s.setInt32(r,p,!0),r+=4}else s.setUint32(r,1,!0),r+=4,s.setInt32(r,i.zeroPoint,!0),r+=4;else s.setUint8(r,0),r+=1;let d=i.data.byteLength&4294967295,h=i.data.byteLength/4294967296>>>0;s.setUint32(r,d,!0),r+=4,s.setUint32(r,h,!0),r+=4,a.set(new Uint8Array(i.data),r),r+=i.data.byteLength}return n}async function vt(o,t){let{type:e,skipPatterns:n=[],perChannel:s=!1,symmetric:a=!0,onProgress:r,minTensorSize:i=100}=t,c=o.byteLength,l=[],u=0,d=0;r?.({stage:"analyzing",current:0,total:1,percent:0});let h=zt(o),p=[],m=0,w=0,y=[];for(let L=0;L<h.length;L++){let A=h[L],Ze=(L+1)/h.length*100;if(r?.({stage:"quantizing",current:L+1,total:h.length,percent:Ze,layerName:A.name}),m+=A.data.length,A.data.length<i||n.some(ve=>typeof ve=="string"?A.name.includes(ve):ve.test(A.name))){d++,l.push({name:A.name,originalDtype:A.dtype,quantizedDtype:A.dtype,originalSize:A.data.byteLength,quantizedSize:A.data.byteLength,scale:1,zeroPoint:0,minValue:Math.min(...A.data),maxValue:Math.max(...A.data),skipped:!0,skipReason:A.data.length<i?"Tensor too small":"Matched skip pattern"}),p.push({name:A.name,data:A.data.buffer.slice(0),shape:A.shape,dtype:A.dtype,originalDtype:A.dtype});continue}let Yn=e==="int4"?4:8,v=Ln(A.data,Yn,a,s,0,A.shape),J,Y;switch(e){case"int8":J=Qe(A.data,v.scale,v.zeroPoint,s,s?A.data.length/(A.shape[0]??1):A.data.length).buffer.slice(0),Y="int8";break;case"uint8":J=Cn(A.data,v.scale,v.zeroPoint,s,s?A.data.length/(A.shape[0]??1):A.data.length).buffer.slice(0),Y="uint8";break;case"int4":J=Fs(A.data,v.scale,v.zeroPoint).buffer.slice(0),Y="int4";break;case"float16":J=Nn(A.data).buffer.slice(0),Y="float16";break;case"dynamic":default:J=Qe(A.data,v.scale,v.zeroPoint,s,s?A.data.length/(A.shape[0]??1):A.data.length).buffer.slice(0),Y="int8";break}u++,w+=A.data.length;let ue=v.scale instanceof Float32Array?Array.from(v.scale):v.scale,Ct=v.zeroPoint instanceof Int32Array?Array.from(v.zeroPoint):v.zeroPoint;typeof ue=="number"?y.push(ue):y.push(...ue),l.push({name:A.name,originalDtype:A.dtype,quantizedDtype:Y,originalSize:A.data.byteLength,quantizedSize:J.byteLength,scale:ue,zeroPoint:Ct,minValue:v.min,maxValue:v.max,skipped:!1}),p.push({name:A.name,data:J,shape:A.shape,dtype:Y,originalDtype:A.dtype,scale:ue,zeroPoint:Ct})}r?.({stage:"packing",current:0,total:1,percent:0});let M=Ps({version:1,quantizationType:e,originalSize:c,weights:p});r?.({stage:"complete",current:1,total:1,percent:100});let b=y.length>0?y.reduce((L,A)=>L+A,0)/y.length:1,S=y.length>0?Math.min(...y):1,I=y.length>0?Math.max(...y):1,F=b/(e==="int4"?8:e==="float16"?2:4);return{data:M,originalSize:c,quantizedSize:M.byteLength,compressionRatio:c/M.byteLength,tensorsQuantized:u,tensorsSkipped:d,layerStats:l,stats:{totalParameters:m,quantizedParameters:w,averageScale:b,minScale:S,maxScale:I,errorEstimate:F}}}function Rn(o,t,e={}){let{symmetric:n=!0,perChannel:s=!1}=e,a=o.toFloat32Array(),r=o.shape,c=Ln(a,t==="int4"?4:8,n,s,0,r),l,u;switch(t){case"int8":l=Qe(a,c.scale,c.zeroPoint,s),u="int32";break;case"uint8":l=Cn(a,c.scale,c.zeroPoint,s),u="int32";break;case"float16":l=Nn(a),u="float32";break;default:l=Qe(a,c.scale,c.zeroPoint,s),u="int32"}let d=c.scale instanceof Float32Array?Array.from(c.scale):c.scale,h=c.zeroPoint instanceof Int32Array?Array.from(c.zeroPoint):c.zeroPoint;return{tensor:new g(Array.from(l),r,u),scale:d,zeroPoint:h}}function $n(o,t,e,n){let s=o.toArray(),a=o.shape,r,i=Array.isArray(t)?new Float32Array(t):t,c=Array.isArray(e)?new Int32Array(e):e,l=Array.isArray(t);switch(n){case"int8":r=Ke(new Int8Array(s.map(Number)),i,c,l);break;case"uint8":r=At(new Uint8Array(s.map(Number)),i,c,l);break;case"float16":r=It(new Uint16Array(s.map(Number)));break;default:r=Ke(new Int8Array(s.map(Number)),i,c,l)}return new g(Array.from(r),a,"float32")}function Et(o,t={}){let{ratio:e=.5,method:n="magnitude",threshold:s}=t,a=o.toFloat32Array(),r=o.shape,i=new Float32Array(a.length),c=new Float32Array(a.length),l=0;if(n==="magnitude"){let u=Array.from(a).map(Math.abs).sort((p,m)=>p-m),d=Math.floor(u.length*e),h=s??u[d]??0;for(let p=0;p<a.length;p++)Math.abs(a[p]??0)>h?(i[p]=1,c[p]=a[p]??0):(i[p]=0,c[p]=0,l++)}else if(n==="random")for(let u=0;u<a.length;u++)Math.random()>e?(i[u]=1,c[u]=a[u]??0):(i[u]=0,c[u]=0,l++);return{tensor:new g(Array.from(c),r,"float32"),mask:new g(Array.from(i),r,"float32"),sparsity:l/a.length}}async function On(o,t={}){let{onProgress:e}=t;e?.({current:0,total:1,percent:0});let n=zt(o),s=0,a=0;for(let r of n){s+=r.data.length;let i=new g(Array.from(r.data),r.shape,"float32"),{sparsity:c}=Et(i,t);a+=Math.floor(r.data.length*c)}return e?.({current:1,total:1,percent:100}),{data:o,originalSize:o.byteLength,prunedSize:o.byteLength,sparsity:a/s,parametersPruned:a,totalParameters:s}}async function Bn(o){let t=zt(o),e=o.byteLength,n={},s=0,a=[];for(let l of t){s+=l.data.length;let u=l.dtype==="float32"?4:l.dtype==="float16"?2:l.dtype==="int8"?1:4,d=l.data.length*u;n[l.dtype]||(n[l.dtype]={count:0,size:0}),n[l.dtype].count++,n[l.dtype].size+=d,a.push({name:l.name,size:d,shape:l.shape})}a.sort((l,u)=>u.size-l.size);let r=a.slice(0,10),i={int8:Math.ceil(e/4),uint8:Math.ceil(e/4),int4:Math.ceil(e/8),float16:Math.ceil(e/2),dynamic:Math.ceil(e/4)},c="dynamic";return e>500*1024*1024?c="int4":e>100*1024*1024?c="int8":e>50*1024*1024&&(c="float16"),{totalSize:e,tensorCount:t.length,totalParameters:s,dtypeBreakdown:n,largestTensors:r,estimatedMemory:s*4,recommendedQuantization:c,estimatedQuantizedSizes:i}}async function Un(o,t){let{format:e,quantize:n}=t,s=o;switch(n&&(s=(await vt(o,{type:n})).data),e){case"edgeflow":return s;case"onnx":return s;case"tflite":return s;default:return s}}function _s(o){let t=o instanceof Float32Array?o:new Float32Array(o),e=1/0,n=-1/0,s=0,a=0,r=0,i=0;for(let h=0;h<t.length;h++){let p=t[h]??0;if(isNaN(p)){r++;continue}if(!isFinite(p)){i++;continue}e=Math.min(e,p),n=Math.max(n,p),s+=p,p===0&&a++}let c=t.length-r-i,l=c>0?s/c:0,u=0;for(let h=0;h<t.length;h++){let p=t[h]??0;!isNaN(p)&&isFinite(p)&&(u+=Math.pow(p-l,2))}let d=c>0?Math.sqrt(u/c):0;return{min:e===1/0?0:e,max:n===-1/0?0:n,mean:l,std:d,zeros:a,nans:r,infinities:i,sparsity:a/t.length}}function Ls(o,t=50){let e=o instanceof Float32Array?o:new Float32Array(o),n=1/0,s=-1/0;for(let c=0;c<e.length;c++){let l=e[c]??0;!isNaN(l)&&isFinite(l)&&(n=Math.min(n,l),s=Math.max(s,l))}if(n===1/0||s===-1/0||n===s)return{bins:[n||0],counts:[e.length],binEdges:[n||0,s||0]};let a=(s-n)/t,r=new Array(t).fill(0),i=new Array(t+1);for(let c=0;c<=t;c++)i[c]=n+c*a;for(let c=0;c<e.length;c++){let l=e[c]??0;if(!isNaN(l)&&isFinite(l)){let u=Math.min(Math.floor((l-n)/a),t-1);r[u]++}}return{bins:i.slice(0,-1).map((c,l)=>(c+i[l+1])/2),counts:r,binEdges:i}}function Se(o,t="tensor",e={}){let{histogram:n=!0,maxSample:s=10}=e,a=o.toFloat32Array(),r=o.shape,i=o.size,c=[],l=Math.max(1,Math.floor(i/s));for(let p=0;p<i&&c.length<s;p+=l)c.push(p);let u=c.map(p=>a[p]??0),d=o.dtype==="float32"||o.dtype==="int32"?4:o.dtype==="int64"?8:4,h=i*d;return{name:t,shape:r,dtype:o.dtype,size:i,memoryBytes:h,stats:_s(a),sample:u,histogram:n?Ls(a):void 0}}function qn(o){let{name:t,shape:e,dtype:n,size:s,memoryBytes:a,stats:r,sample:i}=o,c=[`\u250C\u2500 Tensor: ${t} \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500`,`\u2502 Shape: [${e.join(", ")}]`,`\u2502 Dtype: ${n}`,`\u2502 Size: ${s.toLocaleString()} elements`,`\u2502 Memory: ${Ft(a)}`,"\u251C\u2500 Statistics \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500",`\u2502 Min: ${r.min.toFixed(6)}`,`\u2502 Max: ${r.max.toFixed(6)}`,`\u2502 Mean: ${r.mean.toFixed(6)}`,`\u2502 Std: ${r.std.toFixed(6)}`,`\u2502 Sparsity: ${(r.sparsity*100).toFixed(2)}%`];return r.nans>0&&c.push(`\u2502 \u26A0\uFE0F NaN values: ${r.nans}`),r.infinities>0&&c.push(`\u2502 \u26A0\uFE0F Infinity values: ${r.infinities}`),c.push("\u251C\u2500 Sample Values \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500"),c.push(`\u2502 [${i.map(l=>l.toFixed(4)).join(", ")}]`),c.push("\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500"),c.join(`
`)}function Ft(o){return o<1024?`${o} B`:o<1024*1024?`${(o/1024).toFixed(2)} KB`:o<1024*1024*1024?`${(o/(1024*1024)).toFixed(2)} MB`:`${(o/(1024*1024*1024)).toFixed(2)} GB`}var Ie=class{constructor(t={}){f(this,"config");f(this,"events",[]);f(this,"traces",[]);f(this,"performanceMetrics");f(this,"listeners",new Map);f(this,"isEnabled",!0);this.config={logging:t.logging??!0,logLevel:t.logLevel??"info",inspectTensors:t.inspectTensors??!0,maxDisplayValues:t.maxDisplayValues??10,trackPerformance:t.trackPerformance??!0,logger:t.logger??this.defaultLogger.bind(this)},this.performanceMetrics={inferenceCount:0,totalInferenceTime:0,averageInferenceTime:0,minInferenceTime:1/0,maxInferenceTime:0,peakMemoryUsage:0,currentMemoryUsage:0,tensorAllocations:0,tensorDeallocations:0}}defaultLogger(t,e,n){let a=`[edgeFlow.js ${new Date().toISOString()}] [${t.toUpperCase()}]`;switch(t){case"debug":console.debug(a,e,n??"");break;case"info":console.info(a,e,n??"");break;case"warn":console.warn(a,e,n??"");break;case"error":console.error(a,e,n??"");break;default:console.log(a,e,n??"")}}log(t,e,n){if(!this.isEnabled||!this.config.logging)return;let s=["debug","info","warn","error"],a=s.indexOf(this.config.logLevel);s.indexOf(t)>=a&&this.config.logger(t,e,n)}addEvent(t){this.events.push(t);let e=this.listeners.get(t.type)??[];for(let n of e)n(t);this.events.length>1e3&&(this.events=this.events.slice(-1e3))}enable(){this.isEnabled=!0,this.log("info","Debugger enabled")}disable(){this.isEnabled=!1}on(t,e){let n=this.listeners.get(t)??[];return n.push(e),this.listeners.set(t,n),()=>{let s=n.indexOf(e);s!==-1&&n.splice(s,1)}}inspectTensor(t,e="tensor"){let n=Se(t,e,{histogram:!0,maxSample:this.config.maxDisplayValues});return this.config.inspectTensors&&(this.log("debug",`Tensor: ${e}`,n),this.addEvent({type:"tensor",timestamp:Date.now(),message:`Inspected tensor: ${e}`,data:n}),n.stats.nans>0&&this.log("warn",`Tensor "${e}" contains ${n.stats.nans} NaN values`),n.stats.infinities>0&&this.log("warn",`Tensor "${e}" contains ${n.stats.infinities} Infinity values`)),n}startTrace(t){let e=`trace_${Date.now()}_${Math.random().toString(36).slice(2,8)}`,n={id:e,modelId:t,timestamp:Date.now(),inputs:[],outputs:[],duration:0,memoryUsed:0,operations:[]};return this.traces.push(n),this.log("debug",`Started trace: ${e} for model: ${t}`),e}traceInput(t,e,n){let s=this.traces.find(a=>a.id===t);s&&s.inputs.push(Se(e,n))}traceOutput(t,e,n){let s=this.traces.find(a=>a.id===t);s&&s.outputs.push(Se(e,n))}traceOperation(t,e){let n=this.traces.find(s=>s.id===t);n&&n.operations.push(e)}endTrace(t){let e=this.traces.find(n=>n.id===t);if(e)return e.duration=Date.now()-e.timestamp,this.performanceMetrics.inferenceCount++,this.performanceMetrics.totalInferenceTime+=e.duration,this.performanceMetrics.averageInferenceTime=this.performanceMetrics.totalInferenceTime/this.performanceMetrics.inferenceCount,this.performanceMetrics.minInferenceTime=Math.min(this.performanceMetrics.minInferenceTime,e.duration),this.performanceMetrics.maxInferenceTime=Math.max(this.performanceMetrics.maxInferenceTime,e.duration),this.log("info",`Trace completed: ${t}`,{duration:`${e.duration}ms`,inputs:e.inputs.length,outputs:e.outputs.length,operations:e.operations.length}),this.addEvent({type:"inference",timestamp:Date.now(),message:`Inference completed in ${e.duration}ms`,data:e}),e}recordAllocation(t){if(!this.config.trackPerformance)return;this.performanceMetrics.tensorAllocations++;let e=t.size*4;this.performanceMetrics.currentMemoryUsage+=e,this.performanceMetrics.peakMemoryUsage=Math.max(this.performanceMetrics.peakMemoryUsage,this.performanceMetrics.currentMemoryUsage)}recordDeallocation(t){if(!this.config.trackPerformance)return;this.performanceMetrics.tensorDeallocations++;let e=t.size*4;this.performanceMetrics.currentMemoryUsage-=e}getPerformanceMetrics(){return{...this.performanceMetrics}}getEvents(){return[...this.events]}getTraces(){return[...this.traces]}getTrace(t){return this.traces.find(e=>e.id===t)}clear(){this.events=[],this.traces=[],this.performanceMetrics={inferenceCount:0,totalInferenceTime:0,averageInferenceTime:0,minInferenceTime:1/0,maxInferenceTime:0,peakMemoryUsage:0,currentMemoryUsage:0,tensorAllocations:0,tensorDeallocations:0}}export(){return{events:this.getEvents(),traces:this.getTraces(),metrics:this.getPerformanceMetrics(),timestamp:Date.now()}}generateReport(){let t=this.getPerformanceMetrics(),e=this.getTraces(),n=["\u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557","\u2551               edgeFlow.js Debug Report                          \u2551","\u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563","\u2551 Performance Metrics                                             \u2551","\u255F\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2562",`\u2551 Total Inferences:     ${t.inferenceCount.toString().padStart(10)}                          \u2551`,`\u2551 Average Time:         ${t.averageInferenceTime.toFixed(2).padStart(10)}ms                       \u2551`,`\u2551 Min Time:             ${(t.minInferenceTime===1/0?0:t.minInferenceTime).toFixed(2).padStart(10)}ms                       \u2551`,`\u2551 Max Time:             ${t.maxInferenceTime.toFixed(2).padStart(10)}ms                       \u2551`,`\u2551 Peak Memory:          ${Ft(t.peakMemoryUsage).padStart(10)}                          \u2551`,`\u2551 Current Memory:       ${Ft(t.currentMemoryUsage).padStart(10)}                          \u2551`,`\u2551 Tensor Allocations:   ${t.tensorAllocations.toString().padStart(10)}                          \u2551`,`\u2551 Tensor Deallocations: ${t.tensorDeallocations.toString().padStart(10)}                          \u2551`,"\u255F\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2562","\u2551 Recent Traces                                                   \u2551","\u255F\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2562"],s=e.slice(-5);for(let a of s)n.push(`\u2551 ${a.id.slice(0,20).padEnd(20)} | ${a.duration.toFixed(2).padStart(8)}ms | ${a.modelId.slice(0,20).padEnd(20)} \u2551`);return s.length===0&&n.push("\u2551 No traces recorded                                              \u2551"),n.push("\u255A\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255D"),n.join(`
`)}},Je=null;function Dt(o){return(!Je||o)&&(Je=new Ie(o)),Je}function jn(o){let t=Dt(o);return t.enable(),t}function Hn(){Je?.disable()}function Wn(o,t=50,e=10){let{counts:n,binEdges:s}=o,a=Math.max(...n);if(a===0)return"No data to display";let r=[],i=n.map(u=>Math.round(u/a*e));for(let u=e;u>0;u--){let d=u===e?`${a.toString().padStart(6)} \u2502`:"       \u2502";for(let h=0;h<t&&h<i.length;h++)d+=(i[h]??0)>=u?"\u2588":" ";r.push(d)}r.push("       \u2514"+"\u2500".repeat(Math.min(t,i.length)));let c=(s[0]??0).toFixed(2),l=(s[s.length-1]??0).toFixed(2);return r.push(`        ${c}${" ".repeat(Math.max(0,Math.min(t,i.length)-c.length-l.length))}${l}`),r.join(`
`)}function Vn(o,t=40){let e=o.shape;if(e.length!==2)return"Heatmap only supports 2D tensors";let[n,s]=e;if(n===void 0||s===void 0)return"Invalid tensor shape";let a=o.toFloat32Array(),r=1/0,i=-1/0;for(let p=0;p<a.length;p++){let m=a[p]??0;!isNaN(m)&&isFinite(m)&&(r=Math.min(r,m),i=Math.max(i,m))}let c=i-r,l=[" ","\u2591","\u2592","\u2593","\u2588"],u=[],d=Math.max(1,Math.ceil(s/t)),h=Math.min(s,t);for(let p=0;p<n;p++){let m="";for(let w=0;w<h;w++){let y=p*s+w*d,k=a[y]??0,M=c>0?(k-r)/c:0,b=Math.floor(M*(l.length-1));m+=l[b]}u.push(m)}return u.join(`
`)}function Gn(o){let t=[];t.push("\u250C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510"),t.push("\u2502                        Model Architecture                          \u2502"),t.push("\u251C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524");for(let e=0;e<o.length;e++){let n=o[e],s=`[${n.inputShape.join("\xD7")}]`,a=`[${n.outputShape.join("\xD7")}]`;t.push(`\u2502 ${(e+1).toString().padStart(2)}. ${n.name.padEnd(20)} \u2502 ${n.type.padEnd(15)} \u2502`),t.push(`\u2502     ${s.padEnd(15)} \u2192 ${a.padEnd(15)}                   \u2502`),e<o.length-1&&t.push("\u2502                           \u2193                                        \u2502")}return t.push("\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518"),t.join(`
`)}var ze=class{constructor(t={}){f(this,"config");f(this,"samples",[]);f(this,"isRunning",!1);f(this,"intervalId",null);f(this,"alerts",[]);f(this,"alertListeners",[]);f(this,"sampleListeners",[]);f(this,"inferenceCount",0);f(this,"inferenceTimes",[]);f(this,"queueLength",0);f(this,"activeCount",0);f(this,"frameCount",0);f(this,"lastFrameTime",0);f(this,"fps",0);f(this,"rafId",null);f(this,"tensorMemory",0);f(this,"cacheMemory",0);this.config={enabled:t.enabled??!0,sampleInterval:t.sampleInterval??1e3,historySize:t.historySize??60,monitorMemory:t.monitorMemory??!0,monitorFPS:t.monitorFPS??!0,collectors:t.collectors??[]}}start(){this.isRunning||(this.isRunning=!0,this.intervalId=setInterval(()=>{this.collectSample()},this.config.sampleInterval),this.config.monitorFPS&&typeof requestAnimationFrame<"u"&&(this.lastFrameTime=performance.now(),this.frameCount=0,this.monitorFPS()))}stop(){this.isRunning=!1,this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null),this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null)}monitorFPS(){if(!this.isRunning)return;this.frameCount++;let t=performance.now(),e=t-this.lastFrameTime;e>=1e3&&(this.fps=Math.round(this.frameCount*1e3/e),this.frameCount=0,this.lastFrameTime=t),this.rafId=requestAnimationFrame(()=>this.monitorFPS())}collectSample(){let t=Date.now(),e=this.inferenceTimes.length>0?this.inferenceTimes.reduce((d,h)=>d+h,0)/this.inferenceTimes.length:0,n=this.inferenceTimes.length>0?Math.min(...this.inferenceTimes):0,s=this.inferenceTimes.length>0?Math.max(...this.inferenceTimes):0,a=this.inferenceCount/(this.config.sampleInterval/1e3),r={count:this.inferenceCount,avgTime:e,minTime:n,maxTime:s,throughput:a,queueLength:this.queueLength,activeCount:this.activeCount},i=this.collectMemoryMetrics(),c=this.collectSystemMetrics(),l={};for(let d of this.config.collectors)try{Object.assign(l,d())}catch{}let u={timestamp:t,inference:r,memory:i,system:c,custom:l};this.samples.push(u),this.samples.length>this.config.historySize&&this.samples.shift(),this.checkAlerts(u);for(let d of this.sampleListeners)d(u);this.inferenceCount=0,this.inferenceTimes=[]}collectMemoryMetrics(){let t=0,e=0,n=0;if(typeof performance<"u"&&"memory"in performance){let s=performance.memory;t=s.usedJSHeapSize,e=s.totalJSHeapSize,n=s.jsHeapSizeLimit}return{usedHeap:t,totalHeap:e,heapLimit:n,heapUsage:n>0?t/n:0,tensorMemory:this.tensorMemory,cacheMemory:this.cacheMemory}}collectSystemMetrics(){let t=this.samples[this.samples.length-1],e=t?Date.now()-t.timestamp:this.config.sampleInterval,n=!1;typeof navigator<"u"&&"gpu"in navigator&&(n=!0);let s=!1;return typeof navigator<"u"&&"ml"in navigator&&(s=!0),{fps:this.fps,cpuUsage:this.estimateCPUUsage(),deltaTime:e,userAgent:typeof navigator<"u"?navigator.userAgent:"unknown",webgpuAvailable:n,webnnAvailable:s}}estimateCPUUsage(){if(this.inferenceTimes.length===0)return 0;let t=this.inferenceTimes.reduce((e,n)=>e+n,0);return Math.min(1,t/this.config.sampleInterval)}checkAlerts(t){for(let e of this.alerts){let n=this.getMetricValue(t,e.metric);if(n===void 0)continue;let s=!1;switch(e.operator){case">":s=n>e.threshold;break;case"<":s=n<e.threshold;break;case">=":s=n>=e.threshold;break;case"<=":s=n<=e.threshold;break;case"==":s=n===e.threshold;break;case"!=":s=n!==e.threshold;break}if(s){let a={config:e,value:n,timestamp:t.timestamp};for(let r of this.alertListeners)r(a)}}}getMetricValue(t,e){let n=e.split("."),s=t;for(let a of n)if(s&&typeof s=="object"&&a in s)s=s[a];else return;return typeof s=="number"?s:void 0}recordInference(t){this.inferenceCount++,this.inferenceTimes.push(t)}updateQueueLength(t){this.queueLength=t}updateActiveCount(t){this.activeCount=t}updateTensorMemory(t){this.tensorMemory=t}updateCacheMemory(t){this.cacheMemory=t}addAlert(t){this.alerts.push(t)}removeAlert(t){this.alerts=this.alerts.filter(e=>e.metric!==t)}onAlert(t){return this.alertListeners.push(t),()=>{let e=this.alertListeners.indexOf(t);e!==-1&&this.alertListeners.splice(e,1)}}onSample(t){return this.sampleListeners.push(t),()=>{let e=this.sampleListeners.indexOf(t);e!==-1&&this.sampleListeners.splice(e,1)}}getCurrentSample(){return this.samples[this.samples.length-1]}getSamples(){return[...this.samples]}getSamplesInRange(t,e){return this.samples.filter(n=>n.timestamp>=t&&n.timestamp<=e)}getSummary(){if(this.samples.length===0)return{avgInferenceTime:0,avgThroughput:0,avgMemoryUsage:0,avgFPS:0,totalInferences:0,uptime:0};let t=this.samples.reduce((l,u)=>l+u.inference.avgTime,0)/this.samples.length,e=this.samples.reduce((l,u)=>l+u.inference.throughput,0)/this.samples.length,n=this.samples.reduce((l,u)=>l+u.memory.heapUsage,0)/this.samples.length,s=this.samples.reduce((l,u)=>l+u.system.fps,0)/this.samples.length,a=this.samples.reduce((l,u)=>l+u.inference.count,0),r=this.samples[0],c=this.samples[this.samples.length-1].timestamp-r.timestamp;return{avgInferenceTime:t,avgThroughput:e,avgMemoryUsage:n,avgFPS:s,totalInferences:a,uptime:c}}clear(){this.samples=[],this.inferenceCount=0,this.inferenceTimes=[],this.queueLength=0,this.activeCount=0,this.tensorMemory=0,this.cacheMemory=0}export(){return{samples:this.getSamples(),summary:this.getSummary(),config:this.config,timestamp:Date.now()}}};function Xn(o){let t=o.getSummary(),e=o.getSamples(),n=e[e.length-1],s=r=>r<1024?`${r} B`:r<1024*1024?`${(r/1024).toFixed(1)} KB`:r<1024*1024*1024?`${(r/(1024*1024)).toFixed(1)} MB`:`${(r/(1024*1024*1024)).toFixed(1)} GB`;return`
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>edgeFlow.js Performance Dashboard</title>
  <style>
    :root {
      --bg-primary: #0d1117;
      --bg-secondary: #161b22;
      --bg-tertiary: #21262d;
      --text-primary: #f0f6fc;
      --text-secondary: #8b949e;
      --accent: #58a6ff;
      --success: #3fb950;
      --warning: #d29922;
      --error: #f85149;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
    }
    
    .dashboard {
      max-width: 1400px;
      margin: 0 auto;
      padding: 24px;
    }
    
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 32px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--bg-tertiary);
    }
    
    h1 {
      font-size: 24px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .status {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: var(--text-secondary);
    }
    
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--success);
    }
    
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 32px;
    }
    
    .card {
      background: var(--bg-secondary);
      border: 1px solid var(--bg-tertiary);
      border-radius: 12px;
      padding: 20px;
    }
    
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    
    .card-title {
      font-size: 14px;
      font-weight: 500;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .card-value {
      font-size: 36px;
      font-weight: 700;
      font-variant-numeric: tabular-nums;
    }
    
    .card-value.small {
      font-size: 24px;
    }
    
    .card-unit {
      font-size: 14px;
      color: var(--text-secondary);
      margin-left: 4px;
    }
    
    .card-change {
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 4px;
    }
    
    .card-change.up {
      background: rgba(63, 185, 80, 0.2);
      color: var(--success);
    }
    
    .card-change.down {
      background: rgba(248, 81, 73, 0.2);
      color: var(--error);
    }
    
    .progress-bar {
      height: 8px;
      background: var(--bg-tertiary);
      border-radius: 4px;
      overflow: hidden;
      margin-top: 12px;
    }
    
    .progress-fill {
      height: 100%;
      border-radius: 4px;
      transition: width 0.3s ease;
    }
    
    .progress-fill.blue { background: var(--accent); }
    .progress-fill.green { background: var(--success); }
    .progress-fill.yellow { background: var(--warning); }
    .progress-fill.red { background: var(--error); }
    
    .chart-container {
      background: var(--bg-secondary);
      border: 1px solid var(--bg-tertiary);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }
    
    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    
    .chart-title {
      font-size: 16px;
      font-weight: 600;
    }
    
    .chart {
      height: 200px;
      position: relative;
    }
    
    .chart-line {
      stroke: var(--accent);
      stroke-width: 2;
      fill: none;
    }
    
    .chart-area {
      fill: url(#chartGradient);
      opacity: 0.3;
    }
    
    .chart-grid {
      stroke: var(--bg-tertiary);
      stroke-width: 1;
    }
    
    .table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .table th,
    .table td {
      padding: 12px 16px;
      text-align: left;
      border-bottom: 1px solid var(--bg-tertiary);
    }
    
    .table th {
      font-size: 12px;
      font-weight: 500;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .table td {
      font-variant-numeric: tabular-nums;
    }
    
    footer {
      text-align: center;
      padding: 24px;
      color: var(--text-secondary);
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="dashboard">
    <header>
      <h1>
        <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
          <rect width="32" height="32" rx="8" fill="var(--accent)"/>
          <path d="M8 16L14 10L20 16L26 10" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M8 22L14 16L20 22L26 16" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" opacity="0.5"/>
        </svg>
        edgeFlow.js Performance Dashboard
      </h1>
      <div class="status">
        <div class="status-dot"></div>
        Running for ${(r=>r<1e3?`${r.toFixed(0)}ms`:r<6e4?`${(r/1e3).toFixed(1)}s`:`${(r/6e4).toFixed(1)}m`)(t.uptime)}
      </div>
    </header>
    
    <div class="grid">
      <div class="card">
        <div class="card-header">
          <span class="card-title">Total Inferences</span>
        </div>
        <div class="card-value">${t.totalInferences.toLocaleString()}</div>
      </div>
      
      <div class="card">
        <div class="card-header">
          <span class="card-title">Avg Inference Time</span>
        </div>
        <div class="card-value">${t.avgInferenceTime.toFixed(1)}<span class="card-unit">ms</span></div>
      </div>
      
      <div class="card">
        <div class="card-header">
          <span class="card-title">Throughput</span>
        </div>
        <div class="card-value">${t.avgThroughput.toFixed(1)}<span class="card-unit">ops/s</span></div>
      </div>
      
      <div class="card">
        <div class="card-header">
          <span class="card-title">Avg FPS</span>
        </div>
        <div class="card-value">${Math.round(t.avgFPS)}</div>
      </div>
    </div>
    
    <div class="grid">
      <div class="card">
        <div class="card-header">
          <span class="card-title">Memory Usage</span>
        </div>
        <div class="card-value small">${s(n?.memory.usedHeap??0)}</div>
        <div class="progress-bar">
          <div class="progress-fill ${t.avgMemoryUsage>.8?"red":t.avgMemoryUsage>.6?"yellow":"green"}" 
               style="width: ${(t.avgMemoryUsage*100).toFixed(0)}%"></div>
        </div>
      </div>
      
      <div class="card">
        <div class="card-header">
          <span class="card-title">Tensor Memory</span>
        </div>
        <div class="card-value small">${s(n?.memory.tensorMemory??0)}</div>
      </div>
      
      <div class="card">
        <div class="card-header">
          <span class="card-title">Cache Memory</span>
        </div>
        <div class="card-value small">${s(n?.memory.cacheMemory??0)}</div>
      </div>
      
      <div class="card">
        <div class="card-header">
          <span class="card-title">Queue Length</span>
        </div>
        <div class="card-value small">${n?.inference.queueLength??0}</div>
      </div>
    </div>
    
    <div class="chart-container">
      <div class="chart-header">
        <span class="chart-title">Inference Time History</span>
      </div>
      <div class="chart">
        <svg width="100%" height="100%" viewBox="0 0 600 200" preserveAspectRatio="none">
          <defs>
            <linearGradient id="chartGradient" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0%" stop-color="var(--accent)" stop-opacity="0.5"/>
              <stop offset="100%" stop-color="var(--accent)" stop-opacity="0"/>
            </linearGradient>
          </defs>
          ${Cs(e)}
        </svg>
      </div>
    </div>
    
    <div class="chart-container">
      <div class="chart-header">
        <span class="chart-title">Recent Samples</span>
      </div>
      <table class="table">
        <thead>
          <tr>
            <th>Time</th>
            <th>Inferences</th>
            <th>Avg Time</th>
            <th>Throughput</th>
            <th>Memory</th>
            <th>FPS</th>
          </tr>
        </thead>
        <tbody>
          ${e.slice(-10).reverse().map(r=>`
            <tr>
              <td>${new Date(r.timestamp).toLocaleTimeString()}</td>
              <td>${r.inference.count}</td>
              <td>${r.inference.avgTime.toFixed(2)}ms</td>
              <td>${r.inference.throughput.toFixed(1)}/s</td>
              <td>${s(r.memory.usedHeap)}</td>
              <td>${r.system.fps}</td>
            </tr>
          `).join("")}
        </tbody>
      </table>
    </div>
    
    <footer>
      Generated at ${new Date().toLocaleString()} | edgeFlow.js Performance Monitor
    </footer>
  </div>
</body>
</html>
  `.trim()}function Cs(o){if(o.length<2)return"";let t=600,e=180,n=10,s=o.map(u=>u.inference.avgTime),a=Math.max(...s,1),r=o.map((u,d)=>{let h=n+d/(o.length-1)*(t-2*n),p=e-n-u.inference.avgTime/a*(e-2*n);return`${h},${p}`}),i=`M ${r.join(" L ")}`,c=`M ${n},${e-n} L ${r.join(" L ")} L ${t-n},${e-n} Z`,l=[];for(let u=0;u<=4;u++){let d=n+u/4*(e-2*n);l.push(`<line class="chart-grid" x1="${n}" y1="${d}" x2="${t-n}" y2="${d}"/>`)}return`
    ${l.join(`
`)}
    <path class="chart-area" d="${c}"/>
    <path class="chart-line" d="${i}"/>
  `}function Qn(o){let t=o.getSummary(),e=o.getSamples(),n=e[e.length-1],s=c=>c<1024?`${c} B`:c<1024*1024?`${(c/1024).toFixed(1)} KB`:c<1024*1024*1024?`${(c/(1024*1024)).toFixed(1)} MB`:`${(c/(1024*1024*1024)).toFixed(1)} GB`,a=(c,l,u=20)=>{let d=Math.round(c/l*u);return"\u2588".repeat(d)+"\u2591".repeat(u-d)},r=["\u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557","\u2551             edgeFlow.js Performance Monitor Dashboard                   \u2551","\u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563","\u2551                                                                          \u2551",`\u2551  Total Inferences:  ${t.totalInferences.toString().padStart(10)}                                      \u2551`,`\u2551  Avg Inference:     ${t.avgInferenceTime.toFixed(2).padStart(10)}ms                                     \u2551`,`\u2551  Throughput:        ${t.avgThroughput.toFixed(2).padStart(10)} ops/s                                 \u2551`,`\u2551  Avg FPS:           ${Math.round(t.avgFPS).toString().padStart(10)}                                      \u2551`,"\u2551                                                                          \u2551","\u255F\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2562","\u2551 Memory Usage                                                             \u2551",`\u2551  Heap:    ${a(t.avgMemoryUsage,1)} ${(t.avgMemoryUsage*100).toFixed(0).padStart(3)}%            \u2551`,`\u2551  Used:    ${s(n?.memory.usedHeap??0).padStart(10)}                                          \u2551`,`\u2551  Tensor:  ${s(n?.memory.tensorMemory??0).padStart(10)}                                          \u2551`,`\u2551  Cache:   ${s(n?.memory.cacheMemory??0).padStart(10)}                                          \u2551`,"\u2551                                                                          \u2551","\u255F\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2562","\u2551 Inference Time History (last 30 samples)                                 \u2551","\u2551                                                                          \u2551"],i=e.slice(-30);if(i.length>0){let c=i.map(d=>d.inference.avgTime),l=Math.max(...c,1),u=5;for(let d=u;d>0;d--){let h="\u2551  ";for(let p of c){let m=Math.ceil(p/l*u);h+=m>=d?"\u2593":" "}r.push(h.padEnd(76)+"\u2551")}r.push("\u2551  "+"\u2500".repeat(30)+"                                            \u2551")}return r.push("\u2551                                                                          \u2551"),r.push(`\u2551  Last updated: ${new Date().toLocaleString().padEnd(40)}             \u2551`),r.push("\u255A\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255D"),r.join(`
`)}var Ye=null;function Pt(o){return(!Ye||o)&&(Ye=new ze(o)),Ye}function Kn(o){let t=Pt(o);return t.start(),t}function Jn(){Ye?.stop()}async function Ns(o,t){let e=o instanceof ArrayBuffer?o:await _t(o),n=e.byteLength,s,a=0,r=0;switch(t.method){case"int8":({data:s,layersQuantized:a,layersSkipped:r}=Rs(e,t));break;case"uint8":({data:s,layersQuantized:a,layersSkipped:r}=$s(e,t));break;case"float16":({data:s,layersQuantized:a,layersSkipped:r}=Os(e,t));break;case"int4":({data:s,layersQuantized:a,layersSkipped:r}=Bs(e,t));break;default:s=e}return{modelData:s,originalSize:n,quantizedSize:s.byteLength,compressionRatio:n/s.byteLength,stats:{layersQuantized:a,layersSkipped:r}}}async function _t(o){return new ArrayBuffer(0)}function Rs(o,t){let e=new Float32Array(o),n=new Int8Array(e.length),s=0;for(let r=0;r<e.length;r++){let i=Math.abs(e[r]??0);i>s&&(s=i)}let a=s/127;for(let r=0;r<e.length;r++)n[r]=Math.round((e[r]??0)/a);return{data:n.buffer,layersQuantized:1,layersSkipped:0}}function $s(o,t){let e=new Float32Array(o),n=new Uint8Array(e.length),s=1/0,a=-1/0;for(let i=0;i<e.length;i++){let c=e[i]??0;c<s&&(s=c),c>a&&(a=c)}let r=(a-s)/255;for(let i=0;i<e.length;i++)n[i]=Math.round(((e[i]??0)-s)/r);return{data:n.buffer,layersQuantized:1,layersSkipped:0}}function Os(o,t){let e=new Float32Array(o),n=new Uint16Array(e.length);for(let s=0;s<e.length;s++)n[s]=Us(e[s]??0);return{data:n.buffer,layersQuantized:1,layersSkipped:0}}function Bs(o,t){let e=new Float32Array(o),n=new Uint8Array(Math.ceil(e.length/2)),s=0;for(let r=0;r<e.length;r++){let i=Math.abs(e[r]??0);i>s&&(s=i)}let a=s/7;for(let r=0;r<e.length;r+=2){let i=Math.round((e[r]??0)/a)+8,c=Math.round((e[r+1]??0)/a)+8;n[r/2]=(i&15)<<4|c&15}return{data:n.buffer,layersQuantized:1,layersSkipped:0}}function Us(o){let t=new Float32Array(1),e=new Int32Array(t.buffer);t[0]=o;let n=e[0]??0,s=n>>16&32768,a=n>>12&2047,r=n>>23&255;return r<103?s:r>142?(s|=31744,s|=(r===255?0:1)&&n&8388607,s):r<113?(a|=2048,s|=(a>>114-r)+(a>>113-r&1),s):(s|=r-112<<10|a>>1,s+=a&1,s)}async function qs(o,t){let e=o instanceof ArrayBuffer?o:await _t(o),n=new Float32Array(e),s=n.length,r=[...n.map(Math.abs)].sort((u,d)=>u-d),i=Math.floor(t.sparsity*r.length),c=r[i]??0,l=0;for(let u=0;u<n.length;u++)Math.abs(n[u]??0)<c&&(n[u]=0,l++);return{modelData:n.buffer,actualSparsity:l/s,parametersPruned:l,totalParameters:s}}async function js(o){let t=o instanceof ArrayBuffer?o.byteLength:o.metadata.sizeBytes,e=Math.floor(t/4);return{totalParameters:e,sizeBytes:t,layers:[],estimatedFlops:e*2,memoryRequirements:{weights:t,activations:t*.1,total:t*1.1}}}async function Hs(o,t={}){let{warmupRuns:e=3,runs:n=10}=t;for(let h=0;h<e;h++)await o();let s=[];for(let h=0;h<n;h++){let p=performance.now();await o(),s.push(performance.now()-p)}let r=s.reduce((h,p)=>h+p,0)/s.length,i=Math.min(...s),c=Math.max(...s),u=s.map(h=>Math.pow(h-r,2)).reduce((h,p)=>h+p,0)/s.length,d=Math.sqrt(u);return{avgTime:r,minTime:i,maxTime:c,stdDev:d,throughput:1e3/r,times:s}}async function Ws(o,t){let e=o instanceof ArrayBuffer?o:await _t(o);switch(t){case"json":let n=new Float32Array(e);return JSON.stringify(Array.from(n));case"binary":case"onnx":default:return e}}async function va(){let o=await we();return Array.from(o.values()).some(t=>t)}async function Ea(){let o=await we();return o.get("webgpu")?"webgpu":o.get("webnn")?"webnn":o.get("wasm")?"wasm":null}async function Fa(o){let t=new G;await Promise.all(o.map(async e=>{if(!await t.get(e)){let n=await fetch(e);n.ok&&await t.put(e,n)}}))}var Vs="0.1.0";async function Da(){let o=await we();return{version:Vs,runtimes:{webgpu:o.get("webgpu")??!1,webnn:o.get("webnn")??!1,wasm:o.get("wasm")??!1,auto:!0},features:["concurrent-execution","batch-processing","memory-management","model-caching","quantization"]}}export{re as AudioPreprocessor,z as BasePipeline,ce as Cache,dn as EMOTION_LABELS,Ie as EdgeFlowDebugger,x as EdgeFlowError,g as EdgeFlowTensor,T as ErrorCodes,Q as FeatureExtractionPipeline,Oe as IMAGENET_LABELS,K as ImageClassificationPipeline,se as ImagePreprocessor,$e as InferenceCache,de as InferenceScheduler,B as LoadedModelImpl,ee as MemoryManager,he as MemoryScope,fe as ModelCache,G as ModelDownloadCache,Mt as POPULAR_MODELS,ze as PerformanceMonitor,O as RuntimeManager,ke as SENTIMENT_LABELS,X as SentimentAnalysisPipeline,W as TextClassificationPipeline,H as Tokenizer,Vs as VERSION,be as WASMRuntime,xe as WebGPURuntime,Te as WebNNRuntime,Wt as add,js as analyzeModel,Bn as analyzeModelDetailed,qt as arange,Jt as argmax,Hs as benchmark,_n as benchmarkMemory,Fn as benchmarkSuite,pt as cancelPreload,dt as clearModelCache,En as compareBenchmarks,Yt as concat,is as configureScheduler,Wn as createAsciiHistogram,wn as createAudioPreprocessor,le as createBasicTokenizer,cn as createCache,gn as createFeatureExtractionPipeline,xn as createImageClassificationPipeline,Be as createImagePreprocessor,Is as createPipelines,mn as createSentimentAnalysisPipeline,Vn as createTensorHeatmap,pn as createTextClassificationPipeline,rn as createWASMRuntime,Ne as createWebGPURuntime,Re as createWebNNRuntime,ut as deleteCachedModel,It as dequantizeFloat16,Ke as dequantizeInt8,$n as dequantizeTensor,At as dequantizeUint8,Hn as disableDebugging,nt as div,Ge as downloadConfig,Xe as downloadModel,bt as downloadTokenizer,jn as enableDebugging,Ws as exportModel,Un as exportModelAdvanced,Ht as eye,St as float16ToFloat32,Dn as formatBenchmarkResult,Pn as formatComparisonResult,qn as formatTensorInspection,Sn as fromHub,vn as fromTask,Ot as full,fs as gc,Qn as generateAsciiDashboard,Xn as generateDashboardHTML,we as getAvailableRuntimes,ks as getBestRuntime,Ea as getBestRuntimeType,lt as getCachedModel,Dt as getDebugger,kt as getDefaultModel,Da as getInfo,R as getMemoryManager,ds as getMemoryStats,ht as getModelCacheStats,zn as getModelInfo,Pt as getMonitor,un as getPipelineFactory,ft as getPreloadStatus,mt as getPreloadedModel,Ms as getRuntimeManager,_e as getScheduler,Se as inspectTensor,me as isModelCached,va as isSupported,jt as linspace,yt as loadModel,te as loadModelData,Ts as loadModelFromBuffer,hn as loadTokenizer,fn as loadTokenizerFromHub,Xt as matmul,Kt as mean,In as modelExists,Gt as mul,$t as ones,Tn as pipeline,Fa as preload,it as preloadModel,ct as preloadModels,yn as preprocessText,qs as prune,On as pruneModel,Et as pruneTensor,Ns as quantize,vt as quantizeModel,Rn as quantizeTensor,Ut as randn,Bt as random,an as registerAllBackends,j as registerPipeline,ye as registerRuntime,hs as release,De as relu,bs as runBatchInference,Ae as runBenchmark,ge as runInference,en as setScheduler,Pe as sigmoid,D as softmax,Kn as startMonitoring,Jn as stopMonitoring,Vt as sub,Ee as sum,Qt as tanh,Rt as tensor,Gn as visualizeModelArchitecture,ls as withMemoryScope,us as withMemoryScopeSync,tt as zeros};
//# sourceMappingURL=edgeflow.browser.min.js.map
